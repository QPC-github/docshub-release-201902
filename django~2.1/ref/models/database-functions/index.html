
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Database Functions - Django 2.1 - W3cubDocs</title>
  
  <meta name="description" content="The classes documented below provide a way for users to use functions provided by the underlying database as annotations, aggregations, or filters &hellip;">
  <meta name="keywords" content="database, functions, -, django, django~2.1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/django~2.1/ref/models/database-functions/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/django~2.1.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/django~2.1/" class="_nav-link" title="" style="margin-left:0;">Django 2.1</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _sphinx">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1 id="database-functions">Database Functions</h1> <p id="s-module-django.db.models.functions">The classes documented below provide a way for users to use functions provided by the underlying database as annotations, aggregations, or filters in Django. Functions are also <a class="reference internal" href="../expressions/"><span class="doc">expressions</span></a>, so they can be used and combined with other expressions like <a class="reference internal" href="../querysets/#aggregation-functions"><span class="std std-ref">aggregate functions</span></a>.</p> <p>We’ll be using the following model in examples of each function:</p> <pre data-language="python">class Author(models.Model):
    name = models.CharField(max_length=50)
    age = models.PositiveIntegerField(null=True, blank=True)
    alias = models.CharField(max_length=50, null=True, blank=True)
    goes_by = models.CharField(max_length=50, null=True, blank=True)
</pre> <p>We don’t usually recommend allowing <code>null=True</code> for <code>CharField</code> since this allows the field to have two “empty values”, but it’s important for the <code>Coalesce</code> example below.</p>  <h2 id="comparison-functions">Comparison and conversion functions</h2>  <h3 id="cast"><code>Cast</code></h3> <dl class="class" id="s-comparison-and-conversion-functions"> <dt id="django.db.models.functions.Cast">
<code>class Cast(expression, output_field)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/comparison/#Cast" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Forces the result type of <code>expression</code> to be the one from <code>output_field</code>.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models import FloatField
&gt;&gt;&gt; from django.db.models.functions import Cast
&gt;&gt;&gt; Value.objects.create(integer=4)
&gt;&gt;&gt; value = Value.objects.annotate(as_float=Cast('integer', FloatField())).get()
&gt;&gt;&gt; print(value.as_float)
4.0
</pre>   <h3 id="coalesce"><code>Coalesce</code></h3> <dl class="class" id="s-coalesce"> <dt id="django.db.models.functions.Coalesce">
<code>class Coalesce(*expressions, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/comparison/#Coalesce" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Accepts a list of at least two field names or expressions and returns the first non-null value (note that an empty string is not considered a null value). Each argument must be of a similar type, so mixing text and numbers will result in a database error.</p> <p>Usage examples:</p> <pre data-language="python">&gt;&gt;&gt; # Get a screen name from least to most public
&gt;&gt;&gt; from django.db.models import Sum, Value as V
&gt;&gt;&gt; from django.db.models.functions import Coalesce
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith', goes_by='Maggie')
&gt;&gt;&gt; author = Author.objects.annotate(
...    screen_name=Coalesce('alias', 'goes_by', 'name')).get()
&gt;&gt;&gt; print(author.screen_name)
Maggie

&gt;&gt;&gt; # Prevent an aggregate Sum() from returning None
&gt;&gt;&gt; aggregated = Author.objects.aggregate(
...    combined_age=Coalesce(Sum('age'), V(0)),
...    combined_age_default=Sum('age'))
&gt;&gt;&gt; print(aggregated['combined_age'])
0
&gt;&gt;&gt; print(aggregated['combined_age_default'])
None
</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p>A Python value passed to <code>Coalesce</code> on MySQL may be converted to an incorrect type unless explicitly cast to the correct database type:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models import DateTimeField
&gt;&gt;&gt; from django.db.models.functions import Cast, Coalesce
&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; now = timezone.now()
&gt;&gt;&gt; Coalesce('updated', Cast(now, DateTimeField()))
</pre> </div>   <h3 id="greatest"><code>Greatest</code></h3> <dl class="class" id="s-greatest"> <dt id="django.db.models.functions.Greatest">
<code>class Greatest(*expressions, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/comparison/#Greatest" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Accepts a list of at least two field names or expressions and returns the greatest value. Each argument must be of a similar type, so mixing text and numbers will result in a database error.</p> <p>Usage example:</p> <pre data-language="python">class Blog(models.Model):
    body = models.TextField()
    modified = models.DateTimeField(auto_now=True)

class Comment(models.Model):
    body = models.TextField()
    modified = models.DateTimeField(auto_now=True)
    blog = models.ForeignKey(Blog, on_delete=models.CASCADE)

&gt;&gt;&gt; from django.db.models.functions import Greatest
&gt;&gt;&gt; blog = Blog.objects.create(body='Greatest is the best.')
&gt;&gt;&gt; comment = Comment.objects.create(body='No, Least is better.', blog=blog)
&gt;&gt;&gt; comments = Comment.objects.annotate(last_updated=Greatest('modified', 'blog__modified'))
&gt;&gt;&gt; annotated_comment = comments.get()
</pre> <p><code>annotated_comment.last_updated</code> will be the most recent of <code>blog.modified</code> and <code>comment.modified</code>.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p>The behavior of <code>Greatest</code> when one or more expression may be <code>null</code> varies between databases:</p> <ul class="simple"> <li>PostgreSQL: <code>Greatest</code> will return the largest non-null expression, or <code>null</code> if all expressions are <code>null</code>.</li> <li>SQLite, Oracle, and MySQL: If any expression is <code>null</code>, <code>Greatest</code> will return <code>null</code>.</li> </ul> <p class="last">The PostgreSQL behavior can be emulated using <code>Coalesce</code> if you know a sensible minimum value to provide as a default.</p> </div>   <h3 id="least"><code>Least</code></h3> <dl class="class" id="s-least"> <dt id="django.db.models.functions.Least">
<code>class Least(*expressions, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/comparison/#Least" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Accepts a list of at least two field names or expressions and returns the least value. Each argument must be of a similar type, so mixing text and numbers will result in a database error.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p>The behavior of <code>Least</code> when one or more expression may be <code>null</code> varies between databases:</p> <ul class="simple"> <li>PostgreSQL: <code>Least</code> will return the smallest non-null expression, or <code>null</code> if all expressions are <code>null</code>.</li> <li>SQLite, Oracle, and MySQL: If any expression is <code>null</code>, <code>Least</code> will return <code>null</code>.</li> </ul> <p class="last">The PostgreSQL behavior can be emulated using <code>Coalesce</code> if you know a sensible maximum value to provide as a default.</p> </div>    <h2 id="id1">Date functions</h2> <p id="s-date-functions">We’ll be using the following model in examples of each function:</p> <pre data-language="python">class Experiment(models.Model):
    start_datetime = models.DateTimeField()
    start_date = models.DateField(null=True, blank=True)
    start_time = models.TimeField(null=True, blank=True)
    end_datetime = models.DateTimeField(null=True, blank=True)
    end_date = models.DateField(null=True, blank=True)
    end_time = models.TimeField(null=True, blank=True)
</pre>  <h3 id="extract"><code>Extract</code></h3> <dl class="class" id="s-extract"> <dt id="django.db.models.functions.Extract">
<code>class Extract(expression, lookup_name=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#Extract" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Extracts a component of a date as a number.</p> <p>Takes an <code>expression</code> representing a <code>DateField</code>, <code>DateTimeField</code>, <code>TimeField</code>, or <code>DurationField</code> and a <code>lookup_name</code>, and returns the part of the date referenced by <code>lookup_name</code> as an <code>IntegerField</code>. Django usually uses the databases’ extract function, so you may use any <code>lookup_name</code> that your database supports. A <code>tzinfo</code> subclass, usually provided by <code>pytz</code>, can be passed to extract a value in a specific timezone.</p> <div class="versionchanged"> <span class="title">Changed in Django 2.0:</span> <p>Support for <code>DurationField</code> was added.</p> </div> <p>Given the datetime <code>2015-06-15 23:30:01.000321+00:00</code>, the built-in <code>lookup_name</code>s return:</p> <ul class="simple"> <li>“year”: 2015</li> <li>“quarter”: 2</li> <li>“month”: 6</li> <li>“day”: 15</li> <li>“week”: 25</li> <li>“week_day”: 2</li> <li>“hour”: 23</li> <li>“minute”: 30</li> <li>“second”: 1</li> </ul> <p>If a different timezone like <code>Australia/Melbourne</code> is active in Django, then the datetime is converted to the timezone before the value is extracted. The timezone offset for Melbourne in the example date above is +10:00. The values returned when this timezone is active will be the same as above except for:</p> <ul class="simple"> <li>“day”: 16</li> <li>“week_day”: 3</li> <li>“hour”: 9</li> </ul> <div class="admonition-week-day-values admonition"> <p class="first admonition-title"><code>week_day</code> values</p> <p>The <code>week_day</code> <code>lookup_type</code> is calculated differently from most databases and from Python’s standard functions. This function will return <code>1</code> for Sunday, <code>2</code> for Monday, through <code>7</code> for Saturday.</p> <p>The equivalent calculation in Python is:</p> <pre data-language="python">&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; dt = datetime(2015, 6, 15)
&gt;&gt;&gt; (dt.isoweekday() % 7) + 1
2
</pre> </div> <div class="admonition-week-values admonition"> <p class="first admonition-title"><code>week</code> values</p> <p class="last">The <code>week</code> <code>lookup_type</code> is calculated based on <a class="reference external" href="https://en.wikipedia.org/wiki/ISO-8601" target="_blank">ISO-8601</a>, i.e., a week starts on a Monday. The first week of a year is the one that contains the year’s first Thursday, i.e. the first week has the majority (four or more) of its days in the year. The value returned is in the range 1 to 52 or 53.</p> </div> <p>Each <code>lookup_name</code> above has a corresponding <code>Extract</code> subclass (listed below) that should typically be used instead of the more verbose equivalent, e.g. use <code>ExtractYear(...)</code> rather than <code>Extract(..., lookup_name='year')</code>.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; from django.db.models.functions import Extract
&gt;&gt;&gt; start = datetime(2015, 6, 15)
&gt;&gt;&gt; end = datetime(2015, 7, 2)
&gt;&gt;&gt; Experiment.objects.create(
...    start_datetime=start, start_date=start.date(),
...    end_datetime=end, end_date=end.date())
&gt;&gt;&gt; # Add the experiment start year as a field in the QuerySet.
&gt;&gt;&gt; experiment = Experiment.objects.annotate(
...    start_year=Extract('start_datetime', 'year')).get()
&gt;&gt;&gt; experiment.start_year
2015
&gt;&gt;&gt; # How many experiments completed in the same year in which they started?
&gt;&gt;&gt; Experiment.objects.filter(
...    start_datetime__year=Extract('end_datetime', 'year')).count()
1
</pre>  <h4 id="datefield-extracts">
<code>DateField</code> extracts</h4> <dl class="class" id="s-datefield-extracts"> <dt id="django.db.models.functions.ExtractYear">
<code>class ExtractYear(expression, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#ExtractYear" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>lookup_name = 'year'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.ExtractMonth">
<code>class ExtractMonth(expression, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#ExtractMonth" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>lookup_name = 'month'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.ExtractDay">
<code>class ExtractDay(expression, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#ExtractDay" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>lookup_name = 'day'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.ExtractWeekDay">
<code>class ExtractWeekDay(expression, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#ExtractWeekDay" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>lookup_name = 'week_day'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.ExtractWeek">
<code>class ExtractWeek(expression, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#ExtractWeek" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>lookup_name = 'week'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.ExtractQuarter">
<code>class ExtractQuarter(expression, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#ExtractQuarter" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<div class="versionadded"> <span class="title">New in Django 2.0:</span> </div> <dl class="attribute"> <dt>
<code>lookup_name = 'quarter'</code> </dt> 
</dl> </dd>
</dl> <p>These are logically equivalent to <code>Extract('date_field', lookup_name)</code>. Each class is also a <code>Transform</code> registered on <code>DateField</code> and <code>DateTimeField</code> as <code>__(lookup_name)</code>, e.g. <code>__year</code>.</p> <p>Since <code>DateField</code>s don’t have a time component, only <code>Extract</code> subclasses that deal with date-parts can be used with <code>DateField</code>:</p> <pre data-language="python">&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; from django.db.models.functions import (
...     ExtractDay, ExtractMonth, ExtractQuarter, ExtractWeek,
...     ExtractWeekDay, ExtractYear,
... )
&gt;&gt;&gt; start_2015 = datetime(2015, 6, 15, 23, 30, 1, tzinfo=timezone.utc)
&gt;&gt;&gt; end_2015 = datetime(2015, 6, 16, 13, 11, 27, tzinfo=timezone.utc)
&gt;&gt;&gt; Experiment.objects.create(
...    start_datetime=start_2015, start_date=start_2015.date(),
...    end_datetime=end_2015, end_date=end_2015.date())
&gt;&gt;&gt; Experiment.objects.annotate(
...     year=ExtractYear('start_date'),
...     quarter=ExtractQuarter('start_date'),
...     month=ExtractMonth('start_date'),
...     week=ExtractWeek('start_date'),
...     day=ExtractDay('start_date'),
...     weekday=ExtractWeekDay('start_date'),
... ).values('year', 'quarter', 'month', 'week', 'day', 'weekday').get(
...     end_date__year=ExtractYear('start_date'),
... )
{'year': 2015, 'quarter': 2, 'month': 6, 'week': 25, 'day': 15, 'weekday': 2}
</pre>   <h4 id="datetimefield-extracts">
<code>DateTimeField</code> extracts</h4> <p id="s-datetimefield-extracts">In addition to the following, all extracts for <code>DateField</code> listed above may also be used on <code>DateTimeField</code>s .</p> <dl class="class"> <dt id="django.db.models.functions.ExtractHour">
<code>class ExtractHour(expression, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#ExtractHour" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>lookup_name = 'hour'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.ExtractMinute">
<code>class ExtractMinute(expression, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#ExtractMinute" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>lookup_name = 'minute'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.ExtractSecond">
<code>class ExtractSecond(expression, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#ExtractSecond" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>lookup_name = 'second'</code> </dt> 
</dl> </dd>
</dl> <p>These are logically equivalent to <code>Extract('datetime_field', lookup_name)</code>. Each class is also a <code>Transform</code> registered on <code>DateTimeField</code> as <code>__(lookup_name)</code>, e.g. <code>__minute</code>.</p> <p><code>DateTimeField</code> examples:</p> <pre data-language="python">&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; from django.db.models.functions import (
...     ExtractDay, ExtractHour, ExtractMinute, ExtractMonth,
...     ExtractQuarter, ExtractSecond, ExtractWeek, ExtractWeekDay,
...     ExtractYear,
... )
&gt;&gt;&gt; start_2015 = datetime(2015, 6, 15, 23, 30, 1, tzinfo=timezone.utc)
&gt;&gt;&gt; end_2015 = datetime(2015, 6, 16, 13, 11, 27, tzinfo=timezone.utc)
&gt;&gt;&gt; Experiment.objects.create(
...    start_datetime=start_2015, start_date=start_2015.date(),
...    end_datetime=end_2015, end_date=end_2015.date())
&gt;&gt;&gt; Experiment.objects.annotate(
...     year=ExtractYear('start_datetime'),
...     quarter=ExtractQuarter('start_datetime'),
...     month=ExtractMonth('start_datetime'),
...     week=ExtractWeek('start_datetime'),
...     day=ExtractDay('start_datetime'),
...     weekday=ExtractWeekDay('start_datetime'),
...     hour=ExtractHour('start_datetime'),
...     minute=ExtractMinute('start_datetime'),
...     second=ExtractSecond('start_datetime'),
... ).values(
...     'year', 'month', 'week', 'day', 'weekday', 'hour', 'minute', 'second',
... ).get(end_datetime__year=ExtractYear('start_datetime'))
{'year': 2015, 'quarter': 2, 'month': 6, 'week': 25, 'day': 15, 'weekday': 2,
 'hour': 23, 'minute': 30, 'second': 1}
</pre> <p>When <a class="reference internal" href="../../settings/#std:setting-USE_TZ"><code>USE_TZ</code></a> is <code>True</code> then datetimes are stored in the database in UTC. If a different timezone is active in Django, the datetime is converted to that timezone before the value is extracted. The example below converts to the Melbourne timezone (UTC +10:00), which changes the day, weekday, and hour values that are returned:</p> <pre data-language="python">&gt;&gt;&gt; import pytz
&gt;&gt;&gt; melb = pytz.timezone('Australia/Melbourne')  # UTC+10:00
&gt;&gt;&gt; with timezone.override(melb):
...    Experiment.objects.annotate(
...        day=ExtractDay('start_datetime'),
...        weekday=ExtractWeekDay('start_datetime'),
...        hour=ExtractHour('start_datetime'),
...    ).values('day', 'weekday', 'hour').get(
...        end_datetime__year=ExtractYear('start_datetime'),
...    )
{'day': 16, 'weekday': 3, 'hour': 9}
</pre> <p>Explicitly passing the timezone to the <code>Extract</code> function behaves in the same way, and takes priority over an active timezone:</p> <pre data-language="python">&gt;&gt;&gt; import pytz
&gt;&gt;&gt; melb = pytz.timezone('Australia/Melbourne')
&gt;&gt;&gt; Experiment.objects.annotate(
...     day=ExtractDay('start_datetime', tzinfo=melb),
...     weekday=ExtractWeekDay('start_datetime', tzinfo=melb),
...     hour=ExtractHour('start_datetime', tzinfo=melb),
... ).values('day', 'weekday', 'hour').get(
...     end_datetime__year=ExtractYear('start_datetime'),
... )
{'day': 16, 'weekday': 3, 'hour': 9}
</pre>    <h3 id="now"><code>Now</code></h3> <dl class="class" id="s-now"> <dt id="django.db.models.functions.Now">
<code>class Now</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#Now" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Returns the database server’s current date and time when the query is executed, typically using the SQL <code>CURRENT_TIMESTAMP</code>.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models.functions import Now
&gt;&gt;&gt; Article.objects.filter(published__lte=Now())
&lt;QuerySet [&lt;Article: How to Django&gt;]&gt;
</pre> <div class="admonition-postgresql-considerations admonition"> <p class="first admonition-title">PostgreSQL considerations</p> <p class="last">On PostgreSQL, the SQL <code>CURRENT_TIMESTAMP</code> returns the time that the current transaction started. Therefore for cross-database compatibility, <code>Now()</code> uses <code>STATEMENT_TIMESTAMP</code> instead. If you need the transaction timestamp, use <a class="reference internal" href="../../contrib/postgres/functions/#django.contrib.postgres.functions.TransactionNow" title="django.contrib.postgres.functions.TransactionNow"><code>django.contrib.postgres.functions.TransactionNow</code></a>.</p> </div>   <h3 id="trunc"><code>Trunc</code></h3> <dl class="class" id="s-trunc"> <dt id="django.db.models.functions.Trunc">
<code>class Trunc(expression, kind, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#Trunc" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Truncates a date up to a significant component.</p> <p>When you only care if something happened in a particular year, hour, or day, but not the exact second, then <code>Trunc</code> (and its subclasses) can be useful to filter or aggregate your data. For example, you can use <code>Trunc</code> to calculate the number of sales per day.</p> <p><code>Trunc</code> takes a single <code>expression</code>, representing a <code>DateField</code>, <code>TimeField</code>, or <code>DateTimeField</code>, a <code>kind</code> representing a date or time part, and an <code>output_field</code> that’s either <code>DateTimeField()</code>, <code>TimeField()</code>, or <code>DateField()</code>. It returns a datetime, date, or time depending on <code>output_field</code>, with fields up to <code>kind</code> set to their minimum value. If <code>output_field</code> is omitted, it will default to the <code>output_field</code> of <code>expression</code>. A <code>tzinfo</code> subclass, usually provided by <code>pytz</code>, can be passed to truncate a value in a specific timezone.</p> <p>Given the datetime <code>2015-06-15 14:30:50.000321+00:00</code>, the built-in <code>kind</code>s return:</p> <ul class="simple"> <li>“year”: 2015-01-01 00:00:00+00:00</li> <li>“quarter”: 2015-04-01 00:00:00+00:00</li> <li>“month”: 2015-06-01 00:00:00+00:00</li> <li>“week”: 2015-06-15 00:00:00+00:00</li> <li>“day”: 2015-06-15 00:00:00+00:00</li> <li>“hour”: 2015-06-15 14:00:00+00:00</li> <li>“minute”: 2015-06-15 14:30:00+00:00</li> <li>“second”: 2015-06-15 14:30:50+00:00</li> </ul> <p>If a different timezone like <code>Australia/Melbourne</code> is active in Django, then the datetime is converted to the new timezone before the value is truncated. The timezone offset for Melbourne in the example date above is +10:00. The values returned when this timezone is active will be:</p> <ul class="simple"> <li>“year”: 2015-01-01 00:00:00+11:00</li> <li>“quarter”: 2015-04-01 00:00:00+10:00</li> <li>“month”: 2015-06-01 00:00:00+10:00</li> <li>“week”: 2015-06-16 00:00:00+10:00</li> <li>“day”: 2015-06-16 00:00:00+10:00</li> <li>“hour”: 2015-06-16 00:00:00+10:00</li> <li>“minute”: 2015-06-16 00:30:00+10:00</li> <li>“second”: 2015-06-16 00:30:50+10:00</li> </ul> <p>The year has an offset of +11:00 because the result transitioned into daylight saving time.</p> <p>Each <code>kind</code> above has a corresponding <code>Trunc</code> subclass (listed below) that should typically be used instead of the more verbose equivalent, e.g. use <code>TruncYear(...)</code> rather than <code>Trunc(..., kind='year')</code>.</p> <p>The subclasses are all defined as transforms, but they aren’t registered with any fields, because the obvious lookup names are already reserved by the <code>Extract</code> subclasses.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; from django.db.models import Count, DateTimeField
&gt;&gt;&gt; from django.db.models.functions import Trunc
&gt;&gt;&gt; Experiment.objects.create(start_datetime=datetime(2015, 6, 15, 14, 30, 50, 321))
&gt;&gt;&gt; Experiment.objects.create(start_datetime=datetime(2015, 6, 15, 14, 40, 2, 123))
&gt;&gt;&gt; Experiment.objects.create(start_datetime=datetime(2015, 12, 25, 10, 5, 27, 999))
&gt;&gt;&gt; experiments_per_day = Experiment.objects.annotate(
...    start_day=Trunc('start_datetime', 'day', output_field=DateTimeField())
... ).values('start_day').annotate(experiments=Count('id'))
&gt;&gt;&gt; for exp in experiments_per_day:
...     print(exp['start_day'], exp['experiments'])
...
2015-06-15 00:00:00 2
2015-12-25 00:00:00 1
&gt;&gt;&gt; experiments = Experiment.objects.annotate(
...    start_day=Trunc('start_datetime', 'day', output_field=DateTimeField())
... ).filter(start_day=datetime(2015, 6, 15))
&gt;&gt;&gt; for exp in experiments:
...     print(exp.start_datetime)
...
2015-06-15 14:30:50.000321
2015-06-15 14:40:02.000123
</pre>  <h4 id="datefield-truncation">
<code>DateField</code> truncation</h4> <dl class="class" id="s-datefield-truncation"> <dt id="django.db.models.functions.TruncYear">
<code>class TruncYear(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncYear" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>kind = 'year'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.TruncMonth">
<code>class TruncMonth(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncMonth" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>kind = 'month'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.TruncWeek">
<code>class TruncWeek(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncWeek" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Truncates to midnight on the Monday of the week.</p> <dl class="attribute"> <dt>
<code>kind = 'week'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.TruncQuarter">
<code>class TruncQuarter(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncQuarter" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<div class="versionadded"> <span class="title">New in Django 2.0:</span> </div> <dl class="attribute"> <dt>
<code>kind = 'quarter'</code> </dt> 
</dl> </dd>
</dl> <p>These are logically equivalent to <code>Trunc('date_field', kind)</code>. They truncate all parts of the date up to <code>kind</code> which allows grouping or filtering dates with less precision. <code>expression</code> can have an <code>output_field</code> of either <code>DateField</code> or <code>DateTimeField</code>.</p> <p>Since <code>DateField</code>s don’t have a time component, only <code>Trunc</code> subclasses that deal with date-parts can be used with <code>DateField</code>:</p> <pre data-language="python">&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; from django.db.models import Count
&gt;&gt;&gt; from django.db.models.functions import TruncMonth, TruncYear
&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; start1 = datetime(2014, 6, 15, 14, 30, 50, 321, tzinfo=timezone.utc)
&gt;&gt;&gt; start2 = datetime(2015, 6, 15, 14, 40, 2, 123, tzinfo=timezone.utc)
&gt;&gt;&gt; start3 = datetime(2015, 12, 31, 17, 5, 27, 999, tzinfo=timezone.utc)
&gt;&gt;&gt; Experiment.objects.create(start_datetime=start1, start_date=start1.date())
&gt;&gt;&gt; Experiment.objects.create(start_datetime=start2, start_date=start2.date())
&gt;&gt;&gt; Experiment.objects.create(start_datetime=start3, start_date=start3.date())
&gt;&gt;&gt; experiments_per_year = Experiment.objects.annotate(
...    year=TruncYear('start_date')).values('year').annotate(
...    experiments=Count('id'))
&gt;&gt;&gt; for exp in experiments_per_year:
...     print(exp['year'], exp['experiments'])
...
2014-01-01 1
2015-01-01 2

&gt;&gt;&gt; import pytz
&gt;&gt;&gt; melb = pytz.timezone('Australia/Melbourne')
&gt;&gt;&gt; experiments_per_month = Experiment.objects.annotate(
...    month=TruncMonth('start_datetime', tzinfo=melb)).values('month').annotate(
...    experiments=Count('id'))
&gt;&gt;&gt; for exp in experiments_per_month:
...     print(exp['month'], exp['experiments'])
...
2015-06-01 00:00:00+10:00 1
2016-01-01 00:00:00+11:00 1
2014-06-01 00:00:00+10:00 1
</pre>   <h4 id="datetimefield-truncation">
<code>DateTimeField</code> truncation</h4> <dl class="class" id="s-datetimefield-truncation"> <dt id="django.db.models.functions.TruncDate">
<code>class TruncDate(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncDate" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>lookup_name = 'date'</code> </dt> 
</dl> <dl class="attribute"> <dt>
<code>output_field = DateField()</code> </dt> 
</dl> </dd>
</dl> <p><code>TruncDate</code> casts <code>expression</code> to a date rather than using the built-in SQL truncate function. It’s also registered as a transform on <code>DateTimeField</code> as <code>__date</code>.</p> <dl class="class"> <dt id="django.db.models.functions.TruncTime">
<code>class TruncTime(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncTime" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>lookup_name = 'time'</code> </dt> 
</dl> <dl class="attribute"> <dt>
<code>output_field = TimeField()</code> </dt> 
</dl> </dd>
</dl> <p><code>TruncTime</code> casts <code>expression</code> to a time rather than using the built-in SQL truncate function. It’s also registered as a transform on <code>DateTimeField</code> as <code>__time</code>.</p> <dl class="class"> <dt id="django.db.models.functions.TruncDay">
<code>class TruncDay(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncDay" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>kind = 'day'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.TruncHour">
<code>class TruncHour(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncHour" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>kind = 'hour'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.TruncMinute">
<code>class TruncMinute(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncMinute" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>kind = 'minute'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt id="django.db.models.functions.TruncSecond">
<code>class TruncSecond(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncSecond" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>kind = 'second'</code> </dt> 
</dl> </dd>
</dl> <p>These are logically equivalent to <code>Trunc('datetime_field', kind)</code>. They truncate all parts of the date up to <code>kind</code> and allow grouping or filtering datetimes with less precision. <code>expression</code> must have an <code>output_field</code> of <code>DateTimeField</code>.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from datetime import date, datetime
&gt;&gt;&gt; from django.db.models import Count
&gt;&gt;&gt; from django.db.models.functions import (
...     TruncDate, TruncDay, TruncHour, TruncMinute, TruncSecond,
... )
&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; import pytz
&gt;&gt;&gt; start1 = datetime(2014, 6, 15, 14, 30, 50, 321, tzinfo=timezone.utc)
&gt;&gt;&gt; Experiment.objects.create(start_datetime=start1, start_date=start1.date())
&gt;&gt;&gt; melb = pytz.timezone('Australia/Melbourne')
&gt;&gt;&gt; Experiment.objects.annotate(
...     date=TruncDate('start_datetime'),
...     day=TruncDay('start_datetime', tzinfo=melb),
...     hour=TruncHour('start_datetime', tzinfo=melb),
...     minute=TruncMinute('start_datetime'),
...     second=TruncSecond('start_datetime'),
... ).values('date', 'day', 'hour', 'minute', 'second').get()
{'date': datetime.date(2014, 6, 15),
 'day': datetime.datetime(2014, 6, 16, 0, 0, tzinfo=&lt;DstTzInfo 'Australia/Melbourne' AEST+10:00:00 STD&gt;),
 'hour': datetime.datetime(2014, 6, 16, 0, 0, tzinfo=&lt;DstTzInfo 'Australia/Melbourne' AEST+10:00:00 STD&gt;),
 'minute': 'minute': datetime.datetime(2014, 6, 15, 14, 30, tzinfo=&lt;UTC&gt;),
 'second': datetime.datetime(2014, 6, 15, 14, 30, 50, tzinfo=&lt;UTC&gt;)
}
</pre>   <h4 id="timefield-truncation">
<code>TimeField</code> truncation</h4> <dl class="class" id="s-timefield-truncation"> <dt>
<code>class TruncHour(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncHour" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>kind = 'hour'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt>
<code>class TruncMinute(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncMinute" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>kind = 'minute'</code> </dt> 
</dl> </dd>
</dl> <dl class="class"> <dt>
<code>class TruncSecond(expression, output_field=None, tzinfo=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/datetime/#TruncSecond" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<dl class="attribute"> <dt>
<code>kind = 'second'</code> </dt> 
</dl> </dd>
</dl> <p>These are logically equivalent to <code>Trunc('time_field', kind)</code>. They truncate all parts of the time up to <code>kind</code> which allows grouping or filtering times with less precision. <code>expression</code> can have an <code>output_field</code> of either <code>TimeField</code> or <code>DateTimeField</code>.</p> <p>Since <code>TimeField</code>s don’t have a date component, only <code>Trunc</code> subclasses that deal with time-parts can be used with <code>TimeField</code>:</p> <pre data-language="python">&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; from django.db.models import Count, TimeField
&gt;&gt;&gt; from django.db.models.functions import TruncHour
&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; start1 = datetime(2014, 6, 15, 14, 30, 50, 321, tzinfo=timezone.utc)
&gt;&gt;&gt; start2 = datetime(2014, 6, 15, 14, 40, 2, 123, tzinfo=timezone.utc)
&gt;&gt;&gt; start3 = datetime(2015, 12, 31, 17, 5, 27, 999, tzinfo=timezone.utc)
&gt;&gt;&gt; Experiment.objects.create(start_datetime=start1, start_time=start1.time())
&gt;&gt;&gt; Experiment.objects.create(start_datetime=start2, start_time=start2.time())
&gt;&gt;&gt; Experiment.objects.create(start_datetime=start3, start_time=start3.time())
&gt;&gt;&gt; experiments_per_hour = Experiment.objects.annotate(
...    hour=TruncHour('start_datetime', output_field=TimeField()),
... ).values('hour').annotate(experiments=Count('id'))
&gt;&gt;&gt; for exp in experiments_per_hour:
...     print(exp['hour'], exp['experiments'])
...
14:00:00 2
17:00:00 1

&gt;&gt;&gt; import pytz
&gt;&gt;&gt; melb = pytz.timezone('Australia/Melbourne')
&gt;&gt;&gt; experiments_per_hour = Experiment.objects.annotate(
...    hour=TruncHour('start_datetime', tzinfo=melb),
... ).values('hour').annotate(experiments=Count('id'))
&gt;&gt;&gt; for exp in experiments_per_hour:
...     print(exp['hour'], exp['experiments'])
...
2014-06-16 00:00:00+10:00 2
2016-01-01 04:00:00+11:00 1
</pre>     <h2 id="id2">Text functions</h2>  <h3 id="chr"><code>Chr</code></h3> <dl class="class" id="s-text-functions"> <dt id="django.db.models.functions.Chr">
<code>class Chr(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Chr" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Accepts a numeric field or expression and returns the text representation of the expression as a single character. It works the same as Python’s <a class="reference external" href="https://docs.python.org/3/library/functions.html#chr" title="(in Python v3.7)" target="_blank"><code>chr()</code></a> function.</p> <p>Like <a class="reference internal" href="#django.db.models.functions.Length" title="django.db.models.functions.Length"><code>Length</code></a>, it can be registered as a transform on <code>IntegerField</code>. The default lookup name is <code>chr</code>.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models.functions import Chr
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith')
&gt;&gt;&gt; author = Author.objects.filter(name__startswith=Chr(ord('M'))).get()
&gt;&gt;&gt; print(author.name)
Margaret Smith
</pre>   <h3 id="concat"><code>Concat</code></h3> <dl class="class" id="s-concat"> <dt id="django.db.models.functions.Concat">
<code>class Concat(*expressions, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Concat" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Accepts a list of at least two text fields or expressions and returns the concatenated text. Each argument must be of a text or char type. If you want to concatenate a <code>TextField()</code> with a <code>CharField()</code>, then be sure to tell Django that the <code>output_field</code> should be a <code>TextField()</code>. Specifying an <code>output_field</code> is also required when concatenating a <code>Value</code> as in the example below.</p> <p>This function will never have a null result. On backends where a null argument results in the entire expression being null, Django will ensure that each null part is converted to an empty string first.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; # Get the display name as "name (goes_by)"
&gt;&gt;&gt; from django.db.models import CharField, Value as V
&gt;&gt;&gt; from django.db.models.functions import Concat
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith', goes_by='Maggie')
&gt;&gt;&gt; author = Author.objects.annotate(
...     screen_name=Concat(
...         'name', V(' ('), 'goes_by', V(')'),
...         output_field=CharField()
...     )
... ).get()
&gt;&gt;&gt; print(author.screen_name)
Margaret Smith (Maggie)
</pre>   <h3 id="left"><code>Left</code></h3> <dl class="class" id="s-left"> <dt id="django.db.models.functions.Left">
<code>class Left(expression, length, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Left" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Returns the first <code>length</code> characters of the given text field or expression.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models.functions import Left
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith')
&gt;&gt;&gt; author = Author.objects.annotate(first_initial=Left('name', 1)).get()
&gt;&gt;&gt; print(author.first_initial)
M
</pre>   <h3 id="length"><code>Length</code></h3> <dl class="class" id="s-length"> <dt id="django.db.models.functions.Length">
<code>class Length(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Length" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Accepts a single text field or expression and returns the number of characters the value has. If the expression is null, then the length will also be null.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; # Get the length of the name and goes_by fields
&gt;&gt;&gt; from django.db.models.functions import Length
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith')
&gt;&gt;&gt; author = Author.objects.annotate(
...    name_length=Length('name'),
...    goes_by_length=Length('goes_by')).get()
&gt;&gt;&gt; print(author.name_length, author.goes_by_length)
(14, None)
</pre> <p>It can also be registered as a transform. For example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models import CharField
&gt;&gt;&gt; from django.db.models.functions import Length
&gt;&gt;&gt; CharField.register_lookup(Length)
&gt;&gt;&gt; # Get authors whose name is longer than 7 characters
&gt;&gt;&gt; authors = Author.objects.filter(name__length__gt=7)
</pre>   <h3 id="lower"><code>Lower</code></h3> <dl class="class" id="s-lower"> <dt id="django.db.models.functions.Lower">
<code>class Lower(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Lower" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Accepts a single text field or expression and returns the lowercase representation.</p> <p>It can also be registered as a transform as described in <a class="reference internal" href="#django.db.models.functions.Length" title="django.db.models.functions.Length"><code>Length</code></a>.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models.functions import Lower
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith')
&gt;&gt;&gt; author = Author.objects.annotate(name_lower=Lower('name')).get()
&gt;&gt;&gt; print(author.name_lower)
margaret smith
</pre>   <h3 id="lpad"><code>LPad</code></h3> <dl class="class" id="s-lpad"> <dt id="django.db.models.functions.LPad">
<code>class LPad(expression, length, fill_text=Value(' '), **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#LPad" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Returns the value of the given text field or expression padded on the left side with <code>fill_text</code> so that the resulting value is <code>length</code> characters long. The default <code>fill_text</code> is a space.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models import Value
&gt;&gt;&gt; from django.db.models.functions import LPad
&gt;&gt;&gt; Author.objects.create(name='John', alias='j')
&gt;&gt;&gt; Author.objects.update(name=LPad('name', 8, Value('abc')))
1
&gt;&gt;&gt; print(Author.objects.get(alias='j').name)
abcaJohn
</pre>   <h3 id="ltrim"><code>LTrim</code></h3> <dl class="class" id="s-ltrim"> <dt id="django.db.models.functions.LTrim">
<code>class LTrim(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#LTrim" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Similar to <a class="reference internal" href="#django.db.models.functions.Trim" title="django.db.models.functions.Trim"><code>Trim</code></a>, but removes only leading spaces.</p>   <h3 id="ord"><code>Ord</code></h3> <dl class="class" id="s-ord"> <dt id="django.db.models.functions.Ord">
<code>class Ord(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Ord" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Accepts a single text field or expression and returns the Unicode code point value for the first character of that expression. It works similar to Python’s <a class="reference external" href="https://docs.python.org/3/library/functions.html#ord" title="(in Python v3.7)" target="_blank"><code>ord()</code></a> function, but an exception isn’t raised if the expression is more than one character long.</p> <p>It can also be registered as a transform as described in <a class="reference internal" href="#django.db.models.functions.Length" title="django.db.models.functions.Length"><code>Length</code></a>. The default lookup name is <code>ord</code>.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models.functions import Ord
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith')
&gt;&gt;&gt; author = Author.objects.annotate(name_code_point=Ord('name')).get()
&gt;&gt;&gt; print(author.name_code_point)
77
</pre>   <h3 id="repeat"><code>Repeat</code></h3> <dl class="class" id="s-repeat"> <dt id="django.db.models.functions.Repeat">
<code>class Repeat(expression, number, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Repeat" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Returns the value of the given text field or expression repeated <code>number</code> times.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models.functions import Repeat
&gt;&gt;&gt; Author.objects.create(name='John', alias='j')
&gt;&gt;&gt; Author.objects.update(name=Repeat('name', 3))
1
&gt;&gt;&gt; print(Author.objects.get(alias='j').name)
JohnJohnJohn
</pre>   <h3 id="replace"><code>Replace</code></h3> <dl class="class" id="s-replace"> <dt id="django.db.models.functions.Replace">
<code>class Replace(expression, text, replacement=Value(''), **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Replace" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Replaces all occurrences of <code>text</code> with <code>replacement</code> in <code>expression</code>. The default replacement text is the empty string. The arguments to the function are case-sensitive.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models import Value
&gt;&gt;&gt; from django.db.models.functions import Replace
&gt;&gt;&gt; Author.objects.create(name='Margaret Johnson')
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith')
&gt;&gt;&gt; Author.objects.update(name=Replace('name', Value('Margaret'), Value('Margareth')))
2
&gt;&gt;&gt; Author.objects.values('name')
&lt;QuerySet [{'name': 'Margareth Johnson'}, {'name': 'Margareth Smith'}]&gt;
</pre>   <h3 id="right"><code>Right</code></h3> <dl class="class" id="s-right"> <dt id="django.db.models.functions.Right">
<code>class Right(expression, length, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Right" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Returns the last <code>length</code> characters of the given text field or expression.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models.functions import Right
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith')
&gt;&gt;&gt; author = Author.objects.annotate(last_letter=Right('name', 1)).get()
&gt;&gt;&gt; print(author.last_letter)
h
</pre>   <h3 id="rpad"><code>RPad</code></h3> <dl class="class" id="s-rpad"> <dt id="django.db.models.functions.RPad">
<code>class RPad(expression, length, fill_text=Value(' '), **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#RPad" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Similar to <a class="reference internal" href="#django.db.models.functions.LPad" title="django.db.models.functions.LPad"><code>LPad</code></a>, but pads on the right side.</p>   <h3 id="rtrim"><code>RTrim</code></h3> <dl class="class" id="s-rtrim"> <dt id="django.db.models.functions.RTrim">
<code>class RTrim(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#RTrim" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Similar to <a class="reference internal" href="#django.db.models.functions.Trim" title="django.db.models.functions.Trim"><code>Trim</code></a>, but removes only trailing spaces.</p>   <h3 id="strindex"><code>StrIndex</code></h3> <dl class="class" id="s-strindex"> <dt id="django.db.models.functions.StrIndex">
<code>class StrIndex(string, substring, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#StrIndex" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.0:</span> </div> <p>Returns a positive integer corresponding to the 1-indexed position of the first occurrence of <code>substring</code> inside <code>string</code>, or 0 if <code>substring</code> is not found.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models import Value as V
&gt;&gt;&gt; from django.db.models.functions import StrIndex
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith')
&gt;&gt;&gt; Author.objects.create(name='Smith, Margaret')
&gt;&gt;&gt; Author.objects.create(name='Margaret Jackson')
&gt;&gt;&gt; Author.objects.filter(name='Margaret Jackson').annotate(
...     smith_index=StrIndex('name', V('Smith'))
... ).get().smith_index
0
&gt;&gt;&gt; authors = Author.objects.annotate(
...    smith_index=StrIndex('name', V('Smith'))
... ).filter(smith_index__gt=0)
&lt;QuerySet [&lt;Author: Margaret Smith&gt;, &lt;Author: Smith, Margaret&gt;]&gt;
</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">In MySQL, a database table’s <a class="reference internal" href="../../databases/#mysql-collation"><span class="std std-ref">collation</span></a> determines whether string comparisons (such as the <code>expression</code> and <code>substring</code> of this function) are case-sensitive. Comparisons are case-insensitive by default.</p> </div>   <h3 id="substr"><code>Substr</code></h3> <dl class="class" id="s-substr"> <dt id="django.db.models.functions.Substr">
<code>class Substr(expression, pos, length=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Substr" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Returns a substring of length <code>length</code> from the field or expression starting at position <code>pos</code>. The position is 1-indexed, so the position must be greater than 0. If <code>length</code> is <code>None</code>, then the rest of the string will be returned.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; # Set the alias to the first 5 characters of the name as lowercase
&gt;&gt;&gt; from django.db.models.functions import Lower, Substr
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith')
&gt;&gt;&gt; Author.objects.update(alias=Lower(Substr('name', 1, 5)))
1
&gt;&gt;&gt; print(Author.objects.get(name='Margaret Smith').alias)
marga
</pre>   <h3 id="trim"><code>Trim</code></h3> <dl class="class" id="s-trim"> <dt id="django.db.models.functions.Trim">
<code>class Trim(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Trim" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <div class="versionadded"> <span class="title">New in Django 2.1:</span> </div> <p>Returns the value of the given text field or expression with leading and trailing spaces removed.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models.functions import Trim
&gt;&gt;&gt; Author.objects.create(name='  John  ', alias='j')
&gt;&gt;&gt; Author.objects.update(name=Trim('name'))
1
&gt;&gt;&gt; print(Author.objects.get(alias='j').name)
John
</pre>   <h3 id="upper"><code>Upper</code></h3> <dl class="class" id="s-upper"> <dt id="django.db.models.functions.Upper">
<code>class Upper(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/text/#Upper" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Accepts a single text field or expression and returns the uppercase representation.</p> <p>It can also be registered as a transform as described in <a class="reference internal" href="#django.db.models.functions.Length" title="django.db.models.functions.Length"><code>Length</code></a>.</p> <p>Usage example:</p> <pre data-language="python">&gt;&gt;&gt; from django.db.models.functions import Upper
&gt;&gt;&gt; Author.objects.create(name='Margaret Smith')
&gt;&gt;&gt; author = Author.objects.annotate(name_upper=Upper('name')).get()
&gt;&gt;&gt; print(author.name_upper)
MARGARET SMITH
</pre>    <h2 id="id3">Window functions</h2> <div class="versionadded" id="s-window-functions"> <span class="title">New in Django 2.0:</span> </div> <p>There are a number of functions to use in a <a class="reference internal" href="../expressions/#django.db.models.expressions.Window" title="django.db.models.expressions.Window"><code>Window</code></a> expression for computing the rank of elements or the <a class="reference internal" href="#django.db.models.functions.Ntile" title="django.db.models.functions.Ntile"><code>Ntile</code></a> of some rows.</p>  <h3 id="cumedist"><code>CumeDist</code></h3> <dl class="class" id="s-cumedist"> <dt id="django.db.models.functions.CumeDist">
<code>class CumeDist(*expressions, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#CumeDist" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Calculates the cumulative distribution of a value within a window or partition. The cumulative distribution is defined as the number of rows preceding or peered with the current row divided by the total number of rows in the frame.</p>   <h3 id="denserank"><code>DenseRank</code></h3> <dl class="class" id="s-denserank"> <dt id="django.db.models.functions.DenseRank">
<code>class DenseRank(*expressions, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#DenseRank" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Equivalent to <a class="reference internal" href="#django.db.models.functions.Rank" title="django.db.models.functions.Rank"><code>Rank</code></a> but does not have gaps.</p>   <h3 id="firstvalue"><code>FirstValue</code></h3> <dl class="class" id="s-firstvalue"> <dt id="django.db.models.functions.FirstValue">
<code>class FirstValue(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#FirstValue" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Returns the value evaluated at the row that’s the first row of the window frame, or <code>None</code> if no such value exists.</p>   <h3 id="lag"><code>Lag</code></h3> <dl class="class" id="s-lag"> <dt id="django.db.models.functions.Lag">
<code>class Lag(expression, offset=1, default=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#Lag" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Calculates the value offset by <code>offset</code>, and if no row exists there, returns <code>default</code>.</p> <p><code>default</code> must have the same type as the <code>expression</code>, however, this is only validated by the database and not in Python.</p>   <h3 id="lastvalue"><code>LastValue</code></h3> <dl class="class" id="s-lastvalue"> <dt id="django.db.models.functions.LastValue">
<code>class LastValue(expression, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#LastValue" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Comparable to <a class="reference internal" href="#django.db.models.functions.FirstValue" title="django.db.models.functions.FirstValue"><code>FirstValue</code></a>, it calculates the last value in a given frame clause.</p>   <h3 id="lead"><code>Lead</code></h3> <dl class="class" id="s-lead"> <dt id="django.db.models.functions.Lead">
<code>class Lead(expression, offset=1, default=None, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#Lead" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Calculates the leading value in a given <a class="reference internal" href="../expressions/#window-frames"><span class="std std-ref">frame</span></a>. Both <code>offset</code> and <code>default</code> are evaluated with respect to the current row.</p> <p><code>default</code> must have the same type as the <code>expression</code>, however, this is only validated by the database and not in Python.</p>   <h3 id="nthvalue"><code>NthValue</code></h3> <dl class="class" id="s-nthvalue"> <dt id="django.db.models.functions.NthValue">
<code>class NthValue(expression, nth=1, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#NthValue" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Computes the row relative to the offset <code>nth</code> (must be a positive value) within the window. Returns <code>None</code> if no row exists.</p> <p>Some databases may handle a nonexistent nth-value differently. For example, Oracle returns an empty string rather than <code>None</code> for character-based expressions. Django doesn’t do any conversions in these cases.</p>   <h3 id="ntile"><code>Ntile</code></h3> <dl class="class" id="s-ntile"> <dt id="django.db.models.functions.Ntile">
<code>class Ntile(num_buckets=1, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#Ntile" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Calculates a partition for each of the rows in the frame clause, distributing numbers as evenly as possible between 1 and <code>num_buckets</code>. If the rows don’t divide evenly into a number of buckets, one or more buckets will be represented more frequently.</p>   <h3 id="percentrank"><code>PercentRank</code></h3> <dl class="class" id="s-percentrank"> <dt id="django.db.models.functions.PercentRank">
<code>class PercentRank(*expressions, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#PercentRank" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Computes the percentile rank of the rows in the frame clause. This computation is equivalent to evaluating:</p> <pre data-language="python">(rank - 1) / (total rows - 1)
</pre> <p>The following table explains the calculation for the percentile rank of a row:</p> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Row #</th> <th class="head">Value</th> <th class="head">Rank</th> <th class="head">Calculation</th> <th class="head">Percent Rank</th> </tr> </thead>  <tr>
<td>1</td> <td>15</td> <td>1</td> <td>(1-1)/(7-1)</td> <td>0.0000</td> </tr> <tr>
<td>2</td> <td>20</td> <td>2</td> <td>(2-1)/(7-1)</td> <td>0.1666</td> </tr> <tr>
<td>3</td> <td>20</td> <td>2</td> <td>(2-1)/(7-1)</td> <td>0.1666</td> </tr> <tr>
<td>4</td> <td>20</td> <td>2</td> <td>(2-1)/(7-1)</td> <td>0.1666</td> </tr> <tr>
<td>5</td> <td>30</td> <td>5</td> <td>(5-1)/(7-1)</td> <td>0.6666</td> </tr> <tr>
<td>6</td> <td>30</td> <td>5</td> <td>(5-1)/(7-1)</td> <td>0.6666</td> </tr> <tr>
<td>7</td> <td>40</td> <td>7</td> <td>(7-1)/(7-1)</td> <td>1.0000</td> </tr>  </table>   <h3 id="rank"><code>Rank</code></h3> <dl class="class" id="s-rank"> <dt id="django.db.models.functions.Rank">
<code>class Rank(*expressions, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#Rank" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Comparable to <code>RowNumber</code>, this function ranks rows in the window. The computed rank contains gaps. Use <a class="reference internal" href="#django.db.models.functions.DenseRank" title="django.db.models.functions.DenseRank"><code>DenseRank</code></a> to compute rank without gaps.</p>   <h3 id="rownumber"><code>RowNumber</code></h3> <dl class="class" id="s-rownumber"> <dt id="django.db.models.functions.RowNumber">
<code>class RowNumber(*expressions, **extra)</code> <a class="reference internal" href="https://docs.djangoproject.com/en/2.1/_modules/django/db/models/functions/window/#RowNumber" target="_blank"><span class="viewcode-link">[source]</span></a>
</dt> 
</dl> <p>Computes the row number according to the ordering of either the frame clause or the ordering of the whole query if there is no partitioning of the <a class="reference internal" href="../expressions/#window-frames"><span class="std std-ref">window frame</span></a>.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © Django Software Foundation and individual contributors<br>Licensed under the BSD License.<br>
    <a href="https://docs.djangoproject.com/en/2.1/ref/models/database-functions/" class="_attribution-link" target="_blank">https://docs.djangoproject.com/en/2.1/ref/models/database-functions/</a>
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
