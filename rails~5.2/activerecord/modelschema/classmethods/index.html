
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>ActiveRecord&#58;&#58;ModelSchema&#58;&#58;ClassMethods - Ruby on Rails 5.2 - W3cubDocs</title>
  
  <meta name="description" content=" Returns a hash where the keys are column names and the values are default values when instantiating the Active Record object for this table. ">
  <meta name="keywords" content="module, activerecord, modelschema, classmethods, -, ruby, on, rails, rails~5.2">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/rails~5.2/activerecord/modelschema/classmethods/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/rails~5.2.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/rails~5.2/" class="_nav-link" title="" style="margin-left:0;">Ruby on Rails 5.2</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _rdoc">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1 id="module-ActiveRecord::ModelSchema::ClassMethods" class="module"> module ActiveRecord::ModelSchema::ClassMethods </h1>  <section id="5Buntitled-5D" class="documentation-section"> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-column_defaults"> <span class="method-name">column_defaults</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="column_defaults-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 376
def column_defaults
  load_schema
  @column_defaults ||= _default_attributes.deep_dup.to_hash
end</pre> </div> <p>Returns a hash where the keys are column names and the values are default values when instantiating the Active Record object for this table.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-column_names"> <span class="method-name">column_names</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="column_names-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 387
def column_names
  @column_names ||= columns.map(&amp;:name)
end</pre> </div> <p>Returns an array of column names as strings.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-columns"> <span class="method-name">columns</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="columns-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 340
def columns
  load_schema
  @columns ||= columns_hash.values
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-content_columns"> <span class="method-name">content_columns</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="content_columns-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 393
def content_columns
  @content_columns ||= columns.reject do |c|
    c.name == primary_key ||
    c.name == inheritance_column ||
    c.name.end_with?("_id") ||
    c.name.end_with?("_count")
  end
end</pre> </div> <p>Returns an array of column objects where the primary id, all columns ending in “_id” or “_count”, and columns used for single table inheritance have been removed.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-ignored_columns"> <span class="method-name">ignored_columns</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="ignored_columns-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 264
def ignored_columns
  if defined?(@ignored_columns)
    @ignored_columns
  else
    superclass.ignored_columns
  end
end</pre> </div> <p>The list of columns names the model should ignore. Ignored columns won't have attribute accessors defined, and won't be referenced in SQL queries.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-ignored_columns-3D"> <span class="method-name">ignored_columns=</span><span class="method-args">(columns)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="ignored_columns-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 274
def ignored_columns=(columns)
  @ignored_columns = columns.map(&amp;:to_s)
end</pre> </div> <p>Sets the columns names the model should ignore. Ignored columns won't have attribute accessors defined, and won't be referenced in SQL queries.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-inheritance_column"> <span class="method-name">inheritance_column</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="inheritance_column-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 252
def inheritance_column
  (@inheritance_column ||= nil) || superclass.inheritance_column
end</pre> </div> <p>Defines the name of the table column which will store the class name on single-table inheritance situations.</p> <p>The default inheritance column name is <code>type</code>, which means it's a reserved word inside Active Record. To be able to use single-table inheritance with another column name, or to use the column <code>type</code> in your own model for something else, you can set <code>inheritance_column</code>:</p> <pre class="ruby" data-language="ruby">self.inheritance_column = 'zoink'
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-inheritance_column-3D"> <span class="method-name">inheritance_column=</span><span class="method-args">(value)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="inheritance_column-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 257
def inheritance_column=(value)
  @inheritance_column = value.to_s
  @explicit_inheritance_column = true
end</pre> </div> <p>Sets the value of <a href="../classmethods/#method-i-inheritance_column">#inheritance_column</a></p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-next_sequence_value"> <span class="method-name">next_sequence_value</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="next_sequence_value-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 318
def next_sequence_value
  connection.next_sequence_value(sequence_name)
end</pre> </div> <p>Returns the next value that will be used as the primary key on an insert statement.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-prefetch_primary_key-3F"> <span class="method-name">prefetch_primary_key?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="prefetch_primary_key-3F-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 312
def prefetch_primary_key?
  connection.prefetch_primary_key?(table_name)
end</pre> </div> <p>Determines if the primary key values should be selected from their corresponding sequence before the insert statement.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-protected_environments"> <span class="method-name">protected_environments</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="protected_environments-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 230
def protected_environments
  if defined?(@protected_environments)
    @protected_environments
  else
    superclass.protected_environments
  end
end</pre> </div> <p>The array of names of environments where destructive actions should be prohibited. By default, the value is <code>["production"]</code>.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-protected_environments-3D"> <span class="method-name">protected_environments=</span><span class="method-args">(environments)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="protected_environments-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 239
def protected_environments=(environments)
  @protected_environments = environments.map(&amp;:to_s)
end</pre> </div> <p>Sets an array of names of environments where destructive actions should be prohibited.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-quoted_table_name"> <span class="method-name">quoted_table_name</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="quoted_table_name-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 205
def quoted_table_name
  @quoted_table_name ||= connection.quote_table_name(table_name)
end</pre> </div> <p>Returns a quoted version of the table name, used to construct SQL statements.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-reset_column_information"> <span class="method-name">reset_column_information</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="reset_column_information-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 428
def reset_column_information
  connection.clear_cache!
  ([self] + descendants).each(&amp;:undefine_attribute_methods)
  connection.schema_cache.clear_data_source_cache!(table_name)

  reload_schema_from_cache
  initialize_find_by_cache
end</pre> </div> <p>Resets all the cached information about columns, which will cause them to be reloaded on the next request.</p> <p>The most common usage pattern for this method is probably in a migration, when just after creating a table you want to populate it with some default values, eg:</p> <pre class="ruby" data-language="ruby">class CreateJobLevels &lt; ActiveRecord::Migration[5.0]
  def up
    create_table :job_levels do |t|
      t.integer :id
      t.string :name

      t.timestamps
    end

    JobLevel.reset_column_information
    %w{assistant executive manager director}.each do |type|
      JobLevel.create(name: type)
    end
  end

  def down
    drop_table :job_levels
  end
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-sequence_name"> <span class="method-name">sequence_name</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="sequence_name-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 278
def sequence_name
  if base_class == self
    @sequence_name ||= reset_sequence_name
  else
    (@sequence_name ||= nil) || base_class.sequence_name
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-sequence_name-3D"> <span class="method-name">sequence_name=</span><span class="method-args">(value)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="sequence_name-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 305
def sequence_name=(value)
  @sequence_name          = value.to_s
  @explicit_sequence_name = true
end</pre> </div> <p>Sets the name of the sequence to use when generating ids to the given value, or (if the value is <code>nil</code> or <code>false</code>) to the value returned by the given block. This is required for Oracle and is useful for any database which relies on sequences for primary key generation.</p> <p>If a sequence name is not explicitly set when using Oracle, it will default to the commonly used pattern of: #{table_name}_seq</p> <p>If a sequence name is not explicitly set when using PostgreSQL, it will discover the sequence corresponding to your primary key for you.</p> <pre class="ruby" data-language="ruby">class Project &lt; ActiveRecord::Base
  self.sequence_name = "projectseq"   # default would have been "project_seq"
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-table_exists-3F"> <span class="method-name">table_exists?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="table_exists-3F-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 323
def table_exists?
  connection.schema_cache.data_source_exists?(table_name)
end</pre> </div> <p>Indicates whether the table associated with this class exists</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-table_name"> <span class="method-name">table_name</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="table_name-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 179
def table_name
  reset_table_name unless defined?(@table_name)
  @table_name
end</pre> </div> <p>Guesses the table name (in forced lower-case) based on the name of the class in the inheritance hierarchy descending directly from <a href="../../base/">ActiveRecord::Base</a>. So if the hierarchy looks like: Reply &lt; Message &lt; <a href="../../base/">ActiveRecord::Base</a>, then Message is used to guess the table name even when called on Reply. The rules used to do the guess are handled by the Inflector class in Active Support, which knows almost all common English inflections. You can add new inflections in config/initializers/inflections.rb.</p> <p>Nested classes are given table names prefixed by the singular form of the parent's table name. Enclosing modules are not considered.</p> <h4 id="method-i-table_name-label-Examples">Examples</h4> <pre>class Invoice &lt; ActiveRecord::Base
end

file                  class               table_name
invoice.rb            Invoice             invoices

class Invoice &lt; ActiveRecord::Base
  class Lineitem &lt; ActiveRecord::Base
  end
end

file                  class               table_name
invoice.rb            Invoice::Lineitem   invoice_lineitems

module Invoice
  class Lineitem &lt; ActiveRecord::Base
  end
end

file                  class               table_name
invoice/lineitem.rb   Invoice::Lineitem   lineitems</pre> <p>Additionally, the class-level <code>table_name_prefix</code> is prepended and the <code>table_name_suffix</code> is appended. So if you have “myapp_” as a prefix, the table name guess for an Invoice class becomes “myapp_invoices”. Invoice::Lineitem becomes “myapp_invoice_lineitems”.</p> <p>You can also set your own table name explicitly:</p> <pre class="ruby" data-language="ruby">class Mouse &lt; ActiveRecord::Base
  self.table_name = "mice"
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-table_name-3D"> <span class="method-name">table_name=</span><span class="method-args">(value)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="table_name-3D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 189
def table_name=(value)
  value = value &amp;&amp; value.to_s

  if defined?(@table_name)
    return if value == @table_name
    reset_column_information if connected?
  end

  @table_name        = value
  @quoted_table_name = nil
  @arel_table        = nil
  @sequence_name     = nil unless defined?(@explicit_sequence_name) &amp;&amp; @explicit_sequence_name
  @predicate_builder = nil
end</pre> </div> <p>Sets the table name explicitly. Example:</p> <pre class="ruby" data-language="ruby">class Project &lt; ActiveRecord::Base
  self.table_name = "project"
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-type_for_attribute"> <span class="method-name">type_for_attribute</span><span class="method-args">(attr_name, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="type_for_attribute-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 365
def type_for_attribute(attr_name, &amp;block)
  attr_name = attr_name.to_s
  if block
    attribute_types.fetch(attr_name, &amp;block)
  else
    attribute_types[attr_name]
  end
end</pre> </div> <p>Returns the type of the attribute with the given name, after applying all modifiers. This method is the only valid source of information for anything related to the types of a model's attributes. This method will access the database and load the model's schema if it is required.</p> <p>The return value of this method will implement the interface described by <a href="../../../activemodel/type/value/">ActiveModel::Type::Value</a> (though the object itself may not subclass it).</p> <p><code>attr_name</code> The name of the attribute to retrieve the type for. Must be a string or a symbol.</p>  </div> </div> </section> <section id="protected-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Protected Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-initialize_load_schema_monitor"> <span class="method-name">initialize_load_schema_monitor</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="initialize_load_schema_monitor-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/model_schema.rb, line 439
def initialize_load_schema_monitor
  @load_schema_monitor = Monitor.new
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    © 2004–2018 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
