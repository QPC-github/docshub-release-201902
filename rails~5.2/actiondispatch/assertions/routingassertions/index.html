
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>ActionDispatch&#58;&#58;Assertions&#58;&#58;RoutingAssertions - Ruby on Rails 5.2 - W3cubDocs</title>
  
  <meta name="description" content=" Suite of assertions to test routes generated by Rails and the handling of requests made to them. ">
  <meta name="keywords" content="module, actiondispatch, assertions, routingassertions, -, ruby, on, rails, rails~5.2">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/rails~5.2/actiondispatch/assertions/routingassertions/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/rails~5.2.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/rails~5.2/" class="_nav-link" title="" style="margin-left:0;">Ruby on Rails 5.2</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _rdoc">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1 id="module-ActionDispatch::Assertions::RoutingAssertions" class="module"> module ActionDispatch::Assertions::RoutingAssertions </h1> <section class="description"> <p>Suite of assertions to test routes generated by Rails and the handling of requests made to them.</p> </section> <section id="5Buntitled-5D" class="documentation-section"> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-assert_generates"> <span class="method-name">assert_generates</span><span class="method-args">(expected_path, options, defaults = {}, extras = {}, message = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="assert_generates-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_dispatch/testing/assertions/routing.rb, line 80
def assert_generates(expected_path, options, defaults = {}, extras = {}, message = nil)
  if expected_path =~ %r{://}
    fail_on(URI::InvalidURIError, message) do
      uri = URI.parse(expected_path)
      expected_path = uri.path.to_s.empty? ? "/" : uri.path
    end
  else
    expected_path = "/#{expected_path}" unless expected_path.first == "/"
  end
  # Load routes.rb if it hasn't been loaded.

  options = options.clone
  generated_path, query_string_keys = @routes.generate_extras(options, defaults)
  found_extras = options.reject { |k, _| ! query_string_keys.include? k }

  msg = message || sprintf("found extras &lt;%s&gt;, not &lt;%s&gt;", found_extras, extras)
  assert_equal(extras, found_extras, msg)

  msg = message || sprintf("The generated path &lt;%s&gt; did not match &lt;%s&gt;", generated_path,
      expected_path)
  assert_equal(expected_path, generated_path, msg)
end</pre> </div> <p>Asserts that the provided options can be used to generate the provided path. This is the inverse of <code>assert_recognizes</code>. The <code>extras</code> parameter is used to tell the request the names and values of additional request parameters that would be in a query string. The <code>message</code> parameter allows you to specify a custom error message for assertion failures.</p> <p>The <code>defaults</code> parameter is unused.</p> <pre class="ruby" data-language="ruby"># Asserts that the default action is generated for a route with no action
assert_generates "/items", controller: "items", action: "index"

# Tests that the list action is properly routed
assert_generates "/items/list", controller: "items", action: "list"

# Tests the generation of a route with a parameter
assert_generates "/items/list/1", { controller: "items", action: "list", id: "1" }

# Asserts that the generated route gives us our custom route
assert_generates "changesets/12", { controller: 'scm', action: 'show_diff', revision: "12" }
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-assert_recognizes"> <span class="method-name">assert_recognizes</span><span class="method-args">(expected_options, path, extras = {}, msg = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="assert_recognizes-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_dispatch/testing/assertions/routing.rb, line 42
def assert_recognizes(expected_options, path, extras = {}, msg = nil)
  if path.is_a?(Hash) &amp;&amp; path[:method].to_s == "all"
    [:get, :post, :put, :delete].each do |method|
      assert_recognizes(expected_options, path.merge(method: method), extras, msg)
    end
  else
    request = recognized_request_for(path, extras, msg)

    expected_options = expected_options.clone

    expected_options.stringify_keys!

    msg = message(msg, "") {
      sprintf("The recognized options &lt;%s&gt; did not match &lt;%s&gt;, difference:",
              request.path_parameters, expected_options)
    }

    assert_equal(expected_options, request.path_parameters, msg)
  end
end</pre> </div> <p>Asserts that the routing of the given <code>path</code> was handled correctly and that the parsed options (given in the <code>expected_options</code> hash) match <code>path</code>. Basically, it asserts that Rails recognizes the route given by <code>expected_options</code>.</p> <p>Pass a hash in the second argument (<code>path</code>) to specify the request method. This is useful for routes requiring a specific HTTP method. The hash should contain a :path with the incoming request path and a :method containing the required HTTP verb.</p> <pre class="ruby" data-language="ruby"># Asserts that POSTing to /items will call the create action on ItemsController
assert_recognizes({controller: 'items', action: 'create'}, {path: 'items', method: :post})
</pre> <p>You can also pass in <code>extras</code> with a hash containing URL parameters that would normally be in the query string. This can be used to assert that values in the query string will end up in the params hash correctly. To test query strings you must use the extras argument because appending the query string on the path directly will not work. For example:</p> <pre class="ruby" data-language="ruby"># Asserts that a path of '/items/list/1?view=print' returns the correct options
assert_recognizes({controller: 'items', action: 'list', id: '1', view: 'print'}, 'items/list/1', { view: "print" })
</pre> <p>The <code>message</code> parameter allows you to pass in an error message that is displayed upon failure.</p> <pre class="ruby" data-language="ruby"># Check the default route (i.e., the index action)
assert_recognizes({controller: 'items', action: 'index'}, 'items')

# Test a specific action
assert_recognizes({controller: 'items', action: 'list'}, 'items/list')

# Test an action with a parameter
assert_recognizes({controller: 'items', action: 'destroy', id: '1'}, 'items/destroy/1')

# Test a custom route
assert_recognizes({controller: 'items', action: 'show', id: '1'}, 'view/item1')
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-assert_routing"> <span class="method-name">assert_routing</span><span class="method-args">(path, options, defaults = {}, extras = {}, message = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="assert_routing-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_dispatch/testing/assertions/routing.rb, line 124
def assert_routing(path, options, defaults = {}, extras = {}, message = nil)
  assert_recognizes(options, path, extras, message)

  controller, default_controller = options[:controller], defaults[:controller]
  if controller &amp;&amp; controller.include?(?/) &amp;&amp; default_controller &amp;&amp; default_controller.include?(?/)
    options[:controller] = "/#{controller}"
  end

  generate_options = options.dup.delete_if { |k, _| defaults.key?(k) }
  assert_generates(path.is_a?(Hash) ? path[:path] : path, generate_options, defaults, extras, message)
end</pre> </div> <p>Asserts that path and options match both ways; in other words, it verifies that <code>path</code> generates <code>options</code> and then that <code>options</code> generates <code>path</code>. This essentially combines <code>assert_recognizes</code> and <code>assert_generates</code> into one step.</p> <p>The <code>extras</code> hash allows you to specify options that would normally be provided as a query string to the action. The <code>message</code> parameter allows you to specify a custom error message to display upon failure.</p> <pre class="ruby" data-language="ruby"># Asserts a basic route: a controller with the default action (index)
assert_routing '/home', controller: 'home', action: 'index'

# Test a route generated with a specific controller, action, and parameter (id)
assert_routing '/entries/show/23', controller: 'entries', action: 'show', id: 23

# Asserts a basic route (controller + default action), with an error message if it fails
assert_routing '/store', { controller: 'store', action: 'index' }, {}, {}, 'Route for store index not generated properly'

# Tests a route, providing a defaults hash
assert_routing 'controller/action/9', {id: "9", item: "square"}, {controller: "controller", action: "action"}, {}, {item: "square"}

# Tests a route with an HTTP method
assert_routing({ method: 'put', path: '/product/321' }, { controller: "product", action: "update", id: "321" })
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-method_missing"> <span class="method-name">method_missing</span><span class="method-args">(selector, *args, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="method_missing-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_dispatch/testing/assertions/routing.rb, line 172
def method_missing(selector, *args, &amp;block)
  if defined?(@controller) &amp;&amp; @controller &amp;&amp; defined?(@routes) &amp;&amp; @routes &amp;&amp; @routes.named_routes.route_defined?(selector)
    @controller.send(selector, *args, &amp;block)
  else
    super
  end
end</pre> </div> <p>ROUTES TODO: These assertions should really work in an integration context</p> <div class="method-calls-super"> Calls superclass method </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-with_routing"> <span class="method-name">with_routing</span><span class="method-args">() { |routes| ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="with_routing-source"> <pre class="ruby" data-language="ruby"># File actionpack/lib/action_dispatch/testing/assertions/routing.rb, line 149
def with_routing
  old_routes, @routes = @routes, ActionDispatch::Routing::RouteSet.new
  if defined?(@controller) &amp;&amp; @controller
    old_controller, @controller = @controller, @controller.clone
    _routes = @routes

    @controller.singleton_class.include(_routes.url_helpers)

    if @controller.respond_to? :view_context_class
      @controller.view_context_class = Class.new(@controller.view_context_class) do
        include _routes.url_helpers
      end
    end
  end
  yield @routes
ensure
  @routes = old_routes
  if defined?(@controller) &amp;&amp; @controller
    @controller = old_controller
  end
end</pre> </div> <p>A helper to make it easier to test different route configurations. This method temporarily replaces @routes with a new RouteSet instance.</p> <p>The new instance is yielded to the passed block. Typically the block will create some routes using <code>set.draw { match ... }</code>:</p> <pre class="ruby" data-language="ruby">with_routing do |set|
  set.draw do
    resources :users
  end
  assert_equal "/users", users_path
end
</pre>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    © 2004–2018 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
