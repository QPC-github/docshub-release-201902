
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Schema&#58;&#58;addField - Drupal 8 - W3cubDocs</title>
  
  <meta name="description" content=" Add a new field to a table. ">
  <meta name="keywords" content="public, function, schema, addfield, -, drupal, drupal~8">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/drupal~8/core-lib-drupal-core-database-driver-sqlite-schema.php/function/schema-addfield/8.1.x/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/drupal~8.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/drupal~8/" class="_nav-link" title="" style="margin-left:0;">Drupal 8</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _drupal">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1 id="page-subtitle">public function Schema::addField</h1>     <pre class="signature">public <a href="../../../class/schema/8.1.x/">Schema</a>::addField($table, $field, $specification, $keys_new = array())</pre> <p>Add a new field to a table.</p> <h3>Parameters</h3> <p> <strong>$table</strong>: Name of the table to be altered.</p> <p><strong>$field</strong>: Name of the field to be added.</p> <p><strong>$spec</strong>: The field specification array, as taken from a schema definition. The specification may also contain the key 'initial', the newly created field will be set to the value of the key in all rows. This is most useful for creating NOT NULL columns with no default value in existing tables.</p> <p><strong>$keys_new</strong>: (optional) Keys and indexes specification to be created on the table along with adding the field. The format is the same as a table specification but without the 'fields' element. If you are adding a type 'serial' field, you MUST specify at least one key or index including it in this array. See <a href="../../../../core-includes-database.inc/function/db_change_field/8.1.x/" title="Changes a field definition." class="local">db_change_field</a>() for more explanation why.</p> <h3>Throws</h3> <p> <a href="../../../../core-lib-drupal-core-database-schemaobjectdoesnotexistexception.php/class/schemaobjectdoesnotexistexception/8.1.x/" title="Exception thrown if an object being modified doesn't exist yet." class="local">\Drupal\Core\Database\SchemaObjectDoesNotExistException</a> If the specified table doesn't exist.</p> <p><a href="../../../../core-lib-drupal-core-database-schemaobjectexistsexception.php/class/schemaobjectexistsexception/8.1.x/" title="Exception thrown if an object being created already exists." class="local">\Drupal\Core\Database\SchemaObjectExistsException</a> If the specified table already has a field by that name.</p> <p class="api-override">Overrides <a href="../../../../core-lib-drupal-core-database-schema.php/function/schema-addfield/8.1.x/">Schema::addField</a></p> <h3>File</h3> 
<dl> <dt>core/lib/Drupal/Core/Database/Driver/sqlite/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Database%21Driver%21sqlite%21Schema.php/8.1.x" target="_blank">Schema.php</a>, line 296</dt>  </dl> <h3>Class</h3> 
<dl> <dt>
<a href="../../../class/schema/8.1.x/">Schema</a> </dt> <dd>SQLite implementation of <a href="../../../../core-lib-drupal-core-database-schema.php/class/schema/8.1.x/" title="Provides a base implementation for Database Schema." class="local">\Drupal\Core\Database\Schema</a>.</dd> </dl> <h3>Namespace</h3> <a href="https://api.drupal.org/api/drupal/namespace/Drupal%21Core%21Database%21Driver%21sqlite/8.1.x" target="_blank">Drupal\Core\Database\Driver\sqlite</a> <h3>Code</h3> <pre class="php" data-language="php">public function addField($table, $field, $specification, $keys_new = array()) {
  if (!$this-&gt;tableExists($table)) {
    throw new SchemaObjectDoesNotExistException(t("Cannot add field @table.@field: table doesn't exist.", array('@field' =&gt; $field, '@table' =&gt; $table)));
  }
  if ($this-&gt;fieldExists($table, $field)) {
    throw new SchemaObjectExistsException(t("Cannot add field @table.@field: field already exists.", array('@field' =&gt; $field, '@table' =&gt; $table)));
  }

  // SQLite doesn't have a full-featured ALTER TABLE statement. It only
  // supports adding new fields to a table, in some simple cases. In most
  // cases, we have to create a new table and copy the data over.
  if (empty($keys_new) &amp;&amp; (empty($specification['not null']) || isset($specification['default']))) {
    // When we don't have to create new keys and we are not creating a
    // NOT NULL column without a default value, we can use the quicker version.
    $query = 'ALTER TABLE {' . $table . '} ADD ' . $this-&gt;createFieldSql($field, $this-&gt;processField($specification));
    $this-&gt;connection-&gt;query($query);

    // Apply the initial value if set.
    if (isset($specification['initial'])) {
      $this-&gt;connection-&gt;update($table)
        -&gt;fields(array($field =&gt; $specification['initial']))
        -&gt;execute();
    }
  }
  else {
    // We cannot add the field directly. Use the slower table alteration
    // method, starting from the old schema.
    $old_schema = $this-&gt;introspectSchema($table);
    $new_schema = $old_schema;

    // Add the new field.
    $new_schema['fields'][$field] = $specification;

    // Build the mapping between the old fields and the new fields.
    $mapping = array();
    if (isset($specification['initial'])) {
      // If we have a initial value, copy it over.
      $mapping[$field] = array(
        'expression' =&gt; ':newfieldinitial',
        'arguments' =&gt; array(':newfieldinitial' =&gt; $specification['initial']),
      );
    }
    else {
      // Else use the default of the field.
      $mapping[$field] = NULL;
    }

    // Add the new indexes.
    $new_schema += $keys_new;

    $this-&gt;alterTable($table, $old_schema, $new_schema, $mapping);
  }
}
</pre>
<div class="_attribution">
  <p class="_attribution-p">
    © 2001–2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Database!Driver!sqlite!Schema.php/function/Schema::addField/8.1.x" class="_attribution-link" target="_blank">https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Database!Driver!sqlite!Schema.php/function/Schema::addField/8.1.x</a>
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
