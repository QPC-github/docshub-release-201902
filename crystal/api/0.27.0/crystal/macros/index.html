
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Crystal&#58;&#58;Macros - Crystal - W3cubDocs</title>
  
  <meta name="description" content=" The Macros module is a fictitious module used to document macros and macro methods. ">
  <meta name="keywords" content="module, crystal, macros, -">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/crystal/api/0.27.0/crystal/macros/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/crystal.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/crystal/" class="_nav-link" title="" style="margin-left:0;">Crystal</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _crystal">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1 class="type-name"> module Crystal::Macros </h1> <h2>Overview</h2> <p>The <code><a href="../macros/">Macros</a></code> module is a fictitious module used to document macros and macro methods.</p> <p>You can invoke a <strong>fixed subset</strong> of methods on AST nodes at compile-time. These methods are documented on the classes in this module. Additionally, methods of the <code><a href="../macros/">Macros</a></code> module are top-level methods that you can invoke, like <code><a href="../macros/#puts%28%2Aexpressions%29%3ANop-instance-method">#puts</a></code> and <code><a href="../macros/#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code>.</p> <h2>Defined in:</h2> <a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L7" target="_blank"> compiler/crystal/macros.cr </a> <br> <h2>Instance Method Summary</h2> <ul class="list-summary"> <li class="entry-summary"> <a href="#%60%28command%29%3AMacroId-instance-method" class="signature"><strong>#`</strong>(command) : MacroId</a> <div class="summary"><p>Executes a system command and returns the output as a <code><a href="../macros/macroid/">MacroId</a></code>.</p></div> </li> <li class="entry-summary"> <a href="#compare_versions%28v1%3AStringLiteral%2Cv2%3AStringLiteral%29%3ANumberLiteral-instance-method" class="signature"><strong>#compare_versions</strong>(v1 : StringLiteral, v2 : StringLiteral) : NumberLiteral</a> <div class="summary"><p>Compares two <a href="http://semver.org/" target="_blank">semantic versions</a>.</p></div> </li> <li class="entry-summary"> <a href="#debug%28format%3Dtrue%29%3ANop-instance-method" class="signature"><strong>#debug</strong>(format = true) : Nop</a> <div class="summary"><p>Outputs the current macro's buffer to the standard output.</p></div> </li> <li class="entry-summary"> <a href="#env%28name%29%3AStringLiteral%7CNilLiteral-instance-method" class="signature"><strong>#env</strong>(name) : StringLiteral | NilLiteral</a> <div class="summary"><p>Gets the value of an environment variable at compile-time, or <code>nil</code> if it doesn't exist.</p></div> </li> <li class="entry-summary"> <a href="#flag%3F%28name%29%3ABoolLiteral-instance-method" class="signature"><strong>#flag?</strong>(name) : BoolLiteral</a> <div class="summary"><p>Returns whether a <a href="../../../../docs/syntax_and_semantics/compile_time_flags/" target="_blank">compile-time flag</a> is set.</p></div> </li> <li class="entry-summary"> <a href="#p%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#p</strong>(*expressions) : Nop</a> <div class="summary"><p>Same as <code><a href="../macros/#puts%28%2Aexpressions%29%3ANop-instance-method">#puts</a></code>.</p></div> </li> <li class="entry-summary"> <a href="#p%21%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#p!</strong>(*expressions) : Nop</a> <div class="summary"><p>Prints macro expressions together with their values at compile-time.</p></div> </li> <li class="entry-summary"> <a href="#pp%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#pp</strong>(*expressions) : Nop</a> <div class="summary"><p>Same as <code><a href="../macros/#puts%28%2Aexpressions%29%3ANop-instance-method">#puts</a></code>.</p></div> </li> <li class="entry-summary"> <a href="#pp%21%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#pp!</strong>(*expressions) : Nop</a> <div class="summary"><p>Same as <code><a href="../macros/#p%21%28%2Aexpressions%29%3ANop-instance-method">#p!</a></code></p></div> </li> <li class="entry-summary"> <a href="#puts%28%2Aexpressions%29%3ANop-instance-method" class="signature"><strong>#puts</strong>(*expressions) : Nop</a> <div class="summary"><p>Prints AST nodes at compile-time.</p></div> </li> <li class="entry-summary"> <a href="#raise%28message%29%3ANoReturn-instance-method" class="signature"><strong>#raise</strong>(message) : NoReturn</a> <div class="summary"><p>Gives a compile-time error with the given <em>message</em>.</p></div> </li> <li class="entry-summary"> <a href="#run%28filename%2C%2Aargs%29%3AMacroId-instance-method" class="signature"><strong>#run</strong>(filename, *args) : MacroId</a> <div class="summary"><p>Compiles and execute a Crystal program and returns its output as a <code><a href="../macros/macroid/">MacroId</a></code>.</p></div> </li> <li class="entry-summary"> <a href="#skip_file%3ANop-instance-method" class="signature"><strong>#skip_file</strong> : Nop</a> <div class="summary"><p>Skips the rest of the file from which it is executed.</p></div> </li> <li class="entry-summary"> <a href="#system%28command%29%3AMacroId-instance-method" class="signature"><strong>#system</strong>(command) : MacroId</a> <div class="summary"><p>Executes a system command and returns the output as a <code><a href="../macros/macroid/">MacroId</a></code>.</p></div> </li> </ul>  <h2>Instance Method Detail</h2> <div class="entry-detail" id="`(command):MacroId-instance-method"> <h3 class="signature">def <strong>`</strong>(command) : <a href="../macros/macroid/">MacroId</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L59" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"><p>Executes a system command and returns the output as a <code><a href="../macros/macroid/">MacroId</a></code>. Gives a compile-time error if the command failed to execute.</p></div>   </div> <div class="entry-detail" id="compare_versions(v1:StringLiteral,v2:StringLiteral):NumberLiteral-instance-method"> <h3 class="signature">def <strong>compare_versions</strong>(v1 : <a href="../macros/stringliteral/">StringLiteral</a>, v2 : <a href="../macros/stringliteral/">StringLiteral</a>) : <a href="../macros/numberliteral/">NumberLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L14" target="_blank" class="view-source">Source</a>
</h3> <div class="doc">
<p>Compares two <a href="http://semver.org/" target="_blank">semantic versions</a>. Returns <code>-1</code> if <code>v1 &lt; v2</code>, <code>0</code> if <code>v1 == v2</code> and <code>1</code> if <code>v1 &gt; v2</code>.</p> <pre data-language="crystal">{{ compare_versions("1.10.0", "1.2.0") }} # =&gt; 1</pre>
</div>   </div> <div class="entry-detail" id="debug(format=true):Nop-instance-method"> <h3 class="signature">def <strong>debug</strong>(format = true) : <a href="../macros/nop/">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L22" target="_blank" class="view-source">Source</a>
</h3> <div class="doc">
<p>Outputs the current macro's buffer to the standard output. Useful for debugging a macro to see what's being generated.</p> <p>By default, the output is tried to be formatted using Crystal's formatter, but you can disable this by passing <code>false</code> to this method.</p>
</div>   </div> <div class="entry-detail" id="env(name):StringLiteral|NilLiteral-instance-method"> <h3 class="signature">def <strong>env</strong>(name) : <a href="../macros/stringliteral/">StringLiteral</a> | <a href="../macros/nilliteral/">NilLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L26" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"><p>Gets the value of an environment variable at compile-time, or <code>nil</code> if it doesn't exist.</p></div>   </div> <div class="entry-detail" id="flag?(name):BoolLiteral-instance-method"> <h3 class="signature">def <strong>flag?</strong>(name) : <a href="../macros/boolliteral/">BoolLiteral</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L34" target="_blank" class="view-source">Source</a>
</h3> <div class="doc">
<p>Returns whether a <a href="../../../../docs/syntax_and_semantics/compile_time_flags/" target="_blank">compile-time flag</a> is set.</p> <pre data-language="crystal">{{ flag?(:x86_64) }} # true or false</pre>
</div>   </div> <div class="entry-detail" id="p(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>p</strong>(*expressions) : <a href="../macros/nop/">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L42" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"><p>Same as <code><a href="../macros/#puts%28%2Aexpressions%29%3ANop-instance-method">#puts</a></code>.</p></div>   </div> <div class="entry-detail" id="p!(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>p!</strong>(*expressions) : <a href="../macros/nop/">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L50" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"><p>Prints macro expressions together with their values at compile-time. Useful for debugging macros.</p></div>   </div> <div class="entry-detail" id="pp(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>pp</strong>(*expressions) : <a href="../macros/nop/">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L46" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"><p>Same as <code><a href="../macros/#puts%28%2Aexpressions%29%3ANop-instance-method">#puts</a></code>.</p></div>   </div> <div class="entry-detail" id="pp!(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>pp!</strong>(*expressions) : <a href="../macros/nop/">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L54" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"><p>Same as <code><a href="../macros/#p%21%28%2Aexpressions%29%3ANop-instance-method">#p!</a></code></p></div>   </div> <div class="entry-detail" id="puts(*expressions):Nop-instance-method"> <h3 class="signature">def <strong>puts</strong>(*expressions) : <a href="../macros/nop/">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L38" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"><p>Prints AST nodes at compile-time. Useful for debugging macros.</p></div>   </div> <div class="entry-detail" id="raise(message):NoReturn-instance-method"> <h3 class="signature">def <strong>raise</strong>(message) : NoReturn<a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L67" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"><p>Gives a compile-time error with the given <em>message</em>.</p></div>   </div> <div class="entry-detail" id="run(filename,*args):MacroId-instance-method"> <h3 class="signature">def <strong>run</strong>(filename, *args) : <a href="../macros/macroid/">MacroId</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L110" target="_blank" class="view-source">Source</a>
</h3> <div class="doc">
<p>Compiles and execute a Crystal program and returns its output as a <code><a href="../macros/macroid/">MacroId</a></code>.</p> <p>The file denote by <em>filename</em> must be a valid Crystal program. This macro invocation passes <em>args</em> to the program as regular program arguments. The program must output a valid Crystal expression. This output is the result of this macro invocation, as a <code><a href="../macros/macroid/">MacroId</a></code>.</p> <p>The <code><a href="../macros/#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> macro is useful when the subset of available macro methods are not enough for your purposes and you need something more powerful. With <code><a href="../macros/#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> you can read files at compile time, connect to the internet or to a database.</p> <p>A simple example:</p> <pre data-language="crystal"># read.cr
puts File.read(ARGV[0])</pre> <pre data-language="crystal"># main.cr
macro read_file_at_compile_time(filename)
  {{ run("./read", filename).stringify }}
end

puts read_file_at_compile_time("some_file.txt")</pre> <p>The above generates a program that will have the contents of <code>some_file.txt</code>. The file, however, is read at compile time and will not be needed at runtime.</p> <p>NOTE the compiler is allowed to cache the executable generated for <em>filename</em> and only recompile it if any of the files it depends on changes (their modified time). This is why it's <strong>strongly discouraged</strong> to use a program for <code><a href="../macros/#run%28filename%2C%2Aargs%29%3AMacroId-instance-method">#run</a></code> that changes in subsequent compilations (for example, if it executes shell commands at compile time, or other macro run programs). It's also strongly discouraged to have a macro run program take a lot of time, because this will slow down compilation times. Reading files is OK, opening an HTTP connection at compile-time will most likely result if very slow compilations.</p>
</div>   </div> <div class="entry-detail" id="skip_file:Nop-instance-method"> <h3 class="signature">def <strong>skip_file</strong> : <a href="../macros/nop/">Nop</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L127" target="_blank" class="view-source">Source</a>
</h3> <div class="doc">
<p>Skips the rest of the file from which it is executed. Typical usage is to skip files that have platform specific code, without having to surround the most relevant code in <code>{% if flag?(...) %} ... {% end %}</code> macro blocks.</p> <p>Example:</p> <pre data-language="crystal"># sth_for_osx.cr
{% skip_file unless flag?(:darwin) %}

# Class FooForMac will only be defined if we're compiling on OS X
class FooForMac
end</pre>
</div>   </div> <div class="entry-detail" id="system(command):MacroId-instance-method"> <h3 class="signature">def <strong>system</strong>(command) : <a href="../macros/macroid/">MacroId</a><a href="https://github.com/crystal-lang/crystal/blob/c9d1eef8fde5c7a03a029d64c8483ed7b4f2fe86/src/compiler/crystal/macros.cr#L63" target="_blank" class="view-source">Source</a>
</h3> <div class="doc"><p>Executes a system command and returns the output as a <code><a href="../macros/macroid/">MacroId</a></code>. Gives a compile-time error if the command failed to execute.</p></div>   </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2012–2018 Manas Technology Solutions.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://crystal-lang.org/api/0.27.0/Crystal/Macros.html" class="_attribution-link" target="_blank">https://crystal-lang.org/api/0.27.0/Crystal/Macros.html</a>
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
