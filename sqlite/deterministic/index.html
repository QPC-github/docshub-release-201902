
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Deterministic SQL Functions - SQLite - W3cubDocs</title>
  
  <meta name="description" content=" SQL functions in SQLite can be either &#34;deterministic&#34; or &#34;non-deterministic&#34;. ">
  <meta name="keywords" content="deterministic, sql, functions, -, sqlite">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/sqlite/deterministic/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/sqlite.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/sqlite/" class="_nav-link" title="" style="margin-left:0;">SQLite</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _sqlite">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1 class="fancy_title"> Deterministic SQL Functions </h1>  <h2 id="overview">
<span>1. </span>Overview</h2> <p> SQL functions in SQLite can be either "deterministic" or "non-deterministic". </p>
<p> A deterministic function always gives the same answer when it has the same inputs. Most built-in SQL functions in SQLite are deterministic. For example, the <a href="../lang_corefunc/#abs">abs(X)</a> function always returns the same answer as long as its input X is the same. </p>
<p> Non-deterministic functions might give different answers on each invocation, even if the arguments are always the same. The following are examples of non-deterministic functions: </p>
<ul> <li> <a href="../lang_corefunc/#random">random()</a> </li>
<li> <a href="../lang_corefunc/#changes">changes()</a> </li>
<li> <a href="../lang_corefunc/#last_insert_rowid">last_insert_rowid()</a> </li>
<li> <a href="../c3ref/libversion/">sqlite3_version()</a> </li>
</ul> <p> The <a href="../lang_corefunc/#random">random()</a> function is obviously non-deterministic because it gives a different answer every time it is invoked. The answers from <a href="../lang_corefunc/#changes">changes()</a> and <a href="../lang_corefunc/#last_insert_rowid">last_insert_rowid()</a> depend on prior SQL statements, and so they are also non-deterministic. The <a href="../c3ref/libversion/">sqlite3_version()</a> function is mostly constant, but it can change when SQLite is upgraded, and so even though it always returns the same answer for any particular session, because it can change answers across sessions it is still considered non-deterministic. </p>
<h2 id="restrictions_on_the_use_of_non_deterministic_functions">
<span>2. </span>Restrictions on the use of non-deterministic functions</h2> <p> There are some contexts in SQLite that do not allow the use of non-deterministic functions: </p>
<ul> <li>In the expression of a <a href="../lang_createtable/#ckconst">CHECK constraint</a>. </li>
<li>In the WHERE clause of a <a href="../partialindex/">partial index</a>. </li>
<li>In an expression used as part of an <a href="../expridx/">expression index</a>. </li>
</ul> <p id="dtexception"> In the cases above, the values returned by the function affects the information stored in the database file. The values of functions in CHECK constraints determines which entries are valid for a table, and functions in the WHERE clause of a partial index or in an index on an expression compute values stored in the index b-tree. If any of these functions later returns a different value, then the database might no longer be well-formed. Hence, to avoid database corruption, only deterministic functions can be used in the contexts above.  </p>
<h2 id="special_case_processing_for_date_time_functions">
<span>3. </span>Special-case Processing For Date/Time Functions</h2> <p> The built-in <a href="../lang_datefunc/">date and time functions</a> of SQLite are a special case. These functions are usually considered deterministic. However, if these functions use the string "now" as the date, or if they use the <a href="../lang_datefunc/#localtime">localtime modifier</a> or the <a href="../lang_datefunc/#localtime">utc modifier</a>, then they are considered non-deterministic. Because the function inputs are not necessarily known until run-time, the date/time functions will throw an exception if they encounter any of the non-deterministic features in a context where only deterministic functions are allows. </p>
<p> Prior to SQLite 3.20.0 (2017-08-01) all date/time functions were always considered non-deterministic. The ability for date/time functions to be deterministic sometimes and non-deterministic at other times, depending on their arguments, was added for the 3.20.0 release. </p>
<h2 id="application_defined_deterministic_functions">
<span>4. </span>Application-defined deterministic functions</h2> <p> By default, <a href="../c3ref/create_function/">application-defined SQL functions</a> are considered to be non-deterministic. However, if the 4th parameter to <a href="../c3ref/create_function/">sqlite3_create_function_v2()</a> is OR-ed with <a href="../c3ref/c_deterministic/">SQLITE_DETERMINISTIC</a>, then SQLite will treat that function as if it were deterministic. </p>
<p> Note that if a non-deterministic function is tagged with <a href="../c3ref/c_deterministic/">SQLITE_DETERMINISTIC</a> and if that function ends up being used in the WHERE clause of a <a href="../partialindex/">partial index</a> or in an <a href="../expridx/">expression index</a>, then when the function begins to return different answers, the associated index may become corrupt. If an SQL function is nearly deterministic (which is to say, if it only rarely changes, like <a href="../lang_corefunc/#sqlite_version">sqlite_version()</a>) and it is used in an index that becomes corrupt, the corruption can be fixed by running <a href="../lang_reindex/">REINDEX</a>. </p>
<p> The interfaces necessary to construct a function that is sometimes deterministic and sometimes non-deterministic depending on their inputs, such as the built-in date/time functions, are not published. Generic <a href="../c3ref/create_function/">application-defined SQL functions</a> must be always deterministic or always non-deterministic. </p>
<div class="_attribution">
  <p class="_attribution-p">
    SQLite is in the Public Domain.<br>
    <a href="https://sqlite.org/deterministic.html" class="_attribution-link" target="_blank">https://sqlite.org/deterministic.html</a>
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
