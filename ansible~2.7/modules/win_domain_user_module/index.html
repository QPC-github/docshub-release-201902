
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Win_domain_user - Ansible 2.7 - W3cubDocs</title>
  
  <meta name="description" content=" New in version 2.4. ">
  <meta name="keywords" content="win, domain, user, -, manages, windows, active, directory, accounts, ansible, ansible~2.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/ansible~2.7/modules/win_domain_user_module/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/ansible~2.7.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ansible~2.7/" class="_nav-link" title="" style="margin-left:0;">Ansible 2.7</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _sphinx">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1 id="win-domain-user-module">win_domain_user - Manages Windows Active Directory user accounts</h1> <div class="versionadded" id="win-domain-user-manages-windows-active-directory-user-accounts"> <p><span class="versionmodified">New in version 2.4.</span></p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id3">Notes</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id5">Return Values</a></li> <li><a class="reference internal" href="#status" id="id6">Status</a></li> <li>
<a class="reference internal" href="#maintenance" id="id7">Maintenance</a><ul> <li><a class="reference internal" href="#author" id="id8">Author</a></li> </ul> </li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>Manages Windows Active Directory user accounts.</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1"> <b>account_locked</b> </td> <td> <ul>
<b>Choices:</b> <li>no</li> </ul> </td> <td> <div>
<code>no</code> will unlock the user account if locked. Note that there is not a way to lock an account as an administrator. Accounts are locked due to user actions; as an admin, you may only unlock a locked account. If you wish to administratively disable an account, set <em>enabled</em> to <code>no</code>.</div> </td> </tr> <tr> <td colspan="1"> <b>attributes</b> <br><div style="font-size: small; color: darkgreen">(added in 2.5)</div> </td> <td> </td> <td> <div>A dict of custom LDAP attributes to set on the user.</div> <div>This can be used to set custom attributes that are not exposed as module parameters, e.g. <code>telephoneNumber</code>.</div> <div>See the examples on how to format this parameter.</div> </td> </tr> <tr> <td colspan="1"> <b>city</b> </td> <td> </td> <td> <div>Configures the user's city.</div> </td> </tr> <tr> <td colspan="1"> <b>company</b> </td> <td> </td> <td> <div>Configures the user's company name.</div> </td> </tr> <tr> <td colspan="1"> <b>country</b> </td> <td> </td> <td> <div>Configures the user's country code.</div> <div>Note that this is a two-character ISO 3166 code.</div> </td> </tr> <tr> <td colspan="1"> <b>description</b> </td> <td> </td> <td> <div>Description of the user</div> </td> </tr> <tr> <td colspan="1"> <b>domain_password</b> <br><div style="font-size: small; color: darkgreen">(added in 2.5)</div> </td> <td> </td> <td> <div>The password for <em>username</em>.</div> </td> </tr> <tr> <td colspan="1"> <b>domain_server</b> <br><div style="font-size: small; color: darkgreen">(added in 2.5)</div> </td> <td> </td> <td> <div>Specifies the Active Directory Domain Services instance to connect to.</div> <div>Can be in the form of an FQDN or NetBIOS name.</div> <div>If not specified then the value is based on the domain of the computer running PowerShell.</div> </td> </tr> <tr> <td colspan="1"> <b>domain_username</b> <br><div style="font-size: small; color: darkgreen">(added in 2.5)</div> </td> <td> </td> <td> <div>The username to use when interacting with AD.</div> <div>If this is not set then the user Ansible used to log in with will be used instead when using CredSSP or Kerberos with credential delegation.</div> </td> </tr> <tr> <td colspan="1"> <b>email</b> </td> <td> </td> <td> <div>Configures the user's email address.</div> <div>This is a record in AD and does not do anything to configure any email servers or systems.</div> </td> </tr> <tr> <td colspan="1"> <b>enabled</b> <br><div style="font-size: small; color: red">bool</div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li><div style="color: blue">
<b>yes</b> ←</div></li> </ul> </td> <td> <div>
<code>yes</code> will enable the user account.</div> <div>
<code>no</code> will disable the account.</div> </td> </tr> <tr> <td colspan="1"> <b>firstname</b> </td> <td> </td> <td> <div>Configures the user's first name (given name).</div> </td> </tr> <tr> <td colspan="1"> <b>groups</b> <br><div style="font-size: small; color: red">list</div> </td> <td> </td> <td> <div>Adds or removes the user from this list of groups, depending on the value of <em>groups_action</em>. To remove all but the Principal Group, set <code>groups=&lt;principal group name&gt;</code> and <em>groups_action=replace</em>. Note that users cannot be removed from their principal group (for example, "Domain Users").</div> </td> </tr> <tr> <td colspan="1"> <b>groups_action</b> </td> <td> <ul>
<b>Choices:</b> <li>add</li> <li>remove</li> <li><div style="color: blue">
<b>replace</b> ←</div></li> </ul> </td> <td> <div>If <code>add</code>, the user is added to each group in <em>groups</em> where not already a member.</div> <div>If <code>remove</code>, the user is removed from each group in <em>groups</em>.</div> <div>If <code>replace</code>, the user is added as a member of each group in <em>groups</em> and removed from any other groups.</div> </td> </tr> <tr> <td colspan="1"> <b>name</b> <br><div style="font-size: small; color: red">required</div> </td> <td> </td> <td> <div>Name of the user to create, remove or modify.</div> </td> </tr> <tr> <td colspan="1"> <b>password</b> </td> <td> </td> <td> <div>Optionally set the user's password to this (plain text) value. In order to enable an account - <em>enabled</em> - a password must already be configured on the account, or you must provide a password here.</div> </td> </tr> <tr> <td colspan="1"> <b>password_expired</b> <br><div style="font-size: small; color: red">bool</div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>
<code>yes</code> will require the user to change their password at next login.</div> <div>
<code>no</code> will clear the expired password flag.</div> <div>This is mutually exclusive with <em>password_never_expires</em>.</div> </td> </tr> <tr> <td colspan="1"> <b>password_never_expires</b> <br><div style="font-size: small; color: red">bool</div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>
<code>yes</code> will set the password to never expire.</div> <div>
<code>no</code> will allow the password to expire.</div> <div>This is mutually exclusive with <em>password_expired</em>.</div> </td> </tr> <tr> <td colspan="1"> <b>path</b> </td> <td> </td> <td> <div>Container or OU for the new user; if you do not specify this, the user will be placed in the default container for users in the domain.</div> <div>Setting the path is only available when a new user is created; if you specify a path on an existing user, the user's path will not be updated - you must delete (e.g., state=absent) the user and then re-add the user with the appropriate path.</div> </td> </tr> <tr> <td colspan="1"> <b>postal_code</b> </td> <td> </td> <td> <div>Configures the user's postal code / zip code.</div> </td> </tr> <tr> <td colspan="1"> <b>state</b> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li><div style="color: blue">
<b>present</b> ←</div></li> <li>query</li> </ul> </td> <td> <div>When <code>present</code>, creates or updates the user account. When <code>absent</code>, removes the user account if it exists. When <code>query</code>, retrieves the user account details without making any changes.</div> </td> </tr> <tr> <td colspan="1"> <b>state_province</b> </td> <td> </td> <td> <div>Configures the user's state or province.</div> </td> </tr> <tr> <td colspan="1"> <b>street</b> </td> <td> </td> <td> <div>Configures the user's street address.</div> </td> </tr> <tr> <td colspan="1"> <b>surname</b> </td> <td> </td> <td> <div>Configures the user's last name (surname).</div> </td> </tr> <tr> <td colspan="1"> <b>update_password</b> </td> <td> <ul>
<b>Choices:</b> <li><div style="color: blue">
<b>always</b> ←</div></li> <li>on_create</li> </ul> </td> <td> <div>
<code>always</code> will update passwords if they differ.</div> <div>
<code>on_create</code> will only set the password for newly created users.</div> <div>Note that <code>always</code> will always report an Ansible status of 'changed' because we cannot determine whether the new password differs from the old password.</div> </td> </tr> <tr> <td colspan="1"> <b>upn</b> </td> <td> </td> <td> <div>Configures the User Principal Name (UPN) for the account.</div> <div>This is not required, but is best practice to configure for modern versions of Active Directory.</div> <div>The format is <code>&lt;username&gt;@&lt;domain&gt;</code>.</div> </td> </tr> <tr> <td colspan="1"> <b>user_cannot_change_password</b> <br><div style="font-size: small; color: red">bool</div> </td> <td> <ul>
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>
<code>yes</code> will prevent the user from changing their password.</div> <div>
<code>no</code> will allow the user to change their password.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="first admonition-title">Note</p> <ul class="last simple"> <li>Works with Windows 2012R2 and newer.</li> <li>If running on a server that is not a Domain Controller, credential delegation through CredSSP or Kerberos with delegation must be used or the <em>domain_username</em>, <em>domain_password</em> must be set.</li> <li>Note that some individuals have confirmed successful operation on Windows 2008R2 servers with AD and AD Web Services enabled, but this has not received the same degree of testing as Windows 2012R2.</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml">- name: Ensure user bob is present with address information
  win_domain_user:
    name: bob
    firstname: Bob
    surname: Smith
    company: BobCo
    password: B0bP4ssw0rd
    state: present
    groups:
      - Domain Admins
    street: 123 4th St.
    city: Sometown
    state_province: IN
    postal_code: 12345
    country: US
    attributes:
      telephoneNumber: 555-123456

- name: Ensure user bob is created and use custom credentials to create the user
  win_domain_user:
    name: bob
    firstname: Bob
    surname: Smith
    password: B0bP4ssw0rd
    state: present
    domain_username: DOMAIN\admin-account
    domain_password: SomePas2w0rd
    domain_server: domain@DOMAIN.COM

- name: Ensure user bob is present in OU ou=test,dc=domain,dc=local
  win_domain_user:
    name: bob
    password: B0bP4ssw0rd
    state: present
    path: ou=test,dc=domain,dc=local
    groups:
      - Domain Admins

- name: Ensure user bob is absent
  win_domain_user:
    name: bob
    state: absent
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../reference_appendices/common_return_values/#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1"> <b>account_locked</b> <br><div style="font-size: small; color: red">boolean</div> </td> <td>always</td> <td> <div>true if the account is locked</div> <br> </td> </tr> <tr> <td colspan="1"> <b>changed</b> <br><div style="font-size: small; color: red">boolean</div> </td> <td>always</td> <td> <div>true if the account changed during execution</div> <br> </td> </tr> <tr> <td colspan="1"> <b>city</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The user city</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">Indianapolis</div> </td> </tr> <tr> <td colspan="1"> <b>company</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The user company</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">RedHat</div> </td> </tr> <tr> <td colspan="1"> <b>country</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The user country</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">US</div> </td> </tr> <tr> <td colspan="1"> <b>description</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>A description of the account</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">Server Administrator</div> </td> </tr> <tr> <td colspan="1"> <b>distinguished_name</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>DN of the user account</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">CN=nick,OU=test,DC=domain,DC=local</div> </td> </tr> <tr> <td colspan="1"> <b>email</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The user email address</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">nick@domain.local</div> </td> </tr> <tr> <td colspan="1"> <b>enabled</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>true if the account is enabled and false if disabled</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">True</div> </td> </tr> <tr> <td colspan="1"> <b>firstname</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The user first name</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">Nick</div> </td> </tr> <tr> <td colspan="1"> <b>groups</b> <br><div style="font-size: small; color: red">list</div> </td> <td>always</td> <td> <div>AD Groups to which the account belongs</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">['Domain Admins', 'Domain Users']</div> </td> </tr> <tr> <td colspan="1"> <b>msg</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>Summary message of whether the user is present or absent</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">User nick is present</div> </td> </tr> <tr> <td colspan="1"> <b>name</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The username on the account</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">nick</div> </td> </tr> <tr> <td colspan="1"> <b>password_expired</b> <br><div style="font-size: small; color: red">boolean</div> </td> <td>always</td> <td> <div>true if the account password has expired</div> <br> </td> </tr> <tr> <td colspan="1"> <b>password_updated</b> <br><div style="font-size: small; color: red">boolean</div> </td> <td>always</td> <td> <div>true if the password changed during this execution</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">True</div> </td> </tr> <tr> <td colspan="1"> <b>postal_code</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The user postal code</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">46033</div> </td> </tr> <tr> <td colspan="1"> <b>sid</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The SID of the account</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">S-1-5-21-2752426336-228313920-2202711348-1175</div> </td> </tr> <tr> <td colspan="1"> <b>state</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The state of the user account</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">present</div> </td> </tr> <tr> <td colspan="1"> <b>state_province</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The user state or province</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">IN</div> </td> </tr> <tr> <td colspan="1"> <b>street</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The user street address</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">123 4th St.</div> </td> </tr> <tr> <td colspan="1"> <b>surname</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The user last name</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">Doe</div> </td> </tr> <tr> <td colspan="1"> <b>upn</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>The User Principal Name of the account</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">nick@domain.local</div> </td> </tr> <tr> <td colspan="1"> <b>user_cannot_change_password</b> <br><div style="font-size: small; color: red">string</div> </td> <td>always</td> <td> <div>true if the user is not allowed to change password</div> <br> </td> </tr> </table> <br><br>  <h2 id="status">Status</h2> <p>This module is flagged as <strong>preview</strong> which means that it is not guaranteed to have a backwards compatible interface.</p>   <h2 id="maintenance">Maintenance</h2> <p>This module is flagged as <strong>community</strong> which means that it is maintained by the Ansible Community. See <a class="reference internal" href="../../user_guide/modules_support/#modules-support"><span class="std std-ref">Module Maintenance &amp; Support</span></a> for more info.</p> <p>For a list of other modules that are also maintained by the Ansible Community, see <a class="reference internal" href="../community_maintained/#community-supported"><span class="std std-ref">here</span></a>.</p>  <h3 id="author">Author</h3> <ul class="simple"> <li>Nick Chandler (@nwchandler)</li> </ul> <div class="admonition hint"> <p class="first admonition-title">Hint</p> <p class="last">If you notice any issues in this documentation you can <a class="reference external" href="https://github.com/ansible/ansible/edit/devel/lib/ansible/modules/windows/win_domain_user.py?description=%3C!---%20Your%20description%20here%20--%3E%0A%0A%2Blabel:%20docsite_pr" target="_blank">edit this document</a> to improve it.</p> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2012–2018 Michael DeHaan<br>© 2018 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/2.7/modules/win_domain_user_module.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/2.7/modules/win_domain_user_module.html</a>
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
