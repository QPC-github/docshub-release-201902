
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Wait_for - Ansible 2.7 - W3cubDocs</title>
  
  <meta name="description" content=" Note ">
  <meta name="keywords" content="wait, for, -, waits, condition, before, continuing, ansible, ansible~2.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/ansible~2.7/modules/wait_for_module/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/ansible~2.7.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ansible~2.7/" class="_nav-link" title="" style="margin-left:0;">Ansible 2.7</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _sphinx">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1 id="wait-for-module">wait_for - Waits for a condition before continuing</h1>  <ul class="simple" id="wait-for-waits-for-a-condition-before-continuing"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#parameters" id="id2">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id3">Notes</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> <li><a class="reference internal" href="#status" id="id5">Status</a></li> <li>
<a class="reference internal" href="#maintenance" id="id6">Maintenance</a><ul> <li><a class="reference internal" href="#support" id="id7">Support</a></li> <li><a class="reference internal" href="#author" id="id8">Author</a></li> </ul> </li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>You can wait for a set amount of time <code>timeout</code>, this is the default if nothing is specified or just <code>timeout</code> is specified. This does not produce an error.</li> <li>Waiting for a port to become available is useful for when services are not immediately available after their init scripts return which is true of certain Java application servers. It is also useful when starting guests with the <a class="reference internal" href="../virt_module/#virt-module"><span class="std std-ref">virt</span></a> module and needing to pause until they are ready.</li> <li>This module can also be used to wait for a regex match a string to be present in a file.</li> <li>In 1.6 and later, this module can also be used to wait for a file to be available or absent on the filesystem.</li> <li>In 1.8 and later, this module can also be used to wait for active connections to be closed before continuing, useful if a node is being rotated out of a load balancer pool.</li> <li>For Windows targets, use the <a class="reference internal" href="../win_wait_for_module/#win-wait-for-module"><span class="std std-ref">win_wait_for</span></a> module instead.</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1"> <b>active_connection_states</b> <br><div style="font-size: small; color: darkgreen">(added in 2.3)</div> </td> <td> <b>Default:</b><br><div style="color: blue">[u'ESTABLISHED', u'FIN_WAIT1', u'FIN_WAIT2', u'SYN_RECV', u'SYN_SENT', u'TIME_WAIT']</div> </td> <td> <div>The list of TCP connection states which are counted as active connections.</div> </td> </tr> <tr> <td colspan="1"> <b>connect_timeout</b> </td> <td> <b>Default:</b><br><div style="color: blue">5</div> </td> <td> <div>Maximum number of seconds to wait for a connection to happen before closing and retrying.</div> </td> </tr> <tr> <td colspan="1"> <b>delay</b> </td> <td> <b>Default:</b><br><div style="color: blue">0</div> </td> <td> <div>Number of seconds to wait before starting to poll.</div> </td> </tr> <tr> <td colspan="1"> <b>exclude_hosts</b> <br><div style="font-size: small; color: darkgreen">(added in 1.8)</div> </td> <td> </td> <td> <div>List of hosts or IPs to ignore when looking for active TCP connections for <code>drained</code> state.</div> </td> </tr> <tr> <td colspan="1"> <b>host</b> </td> <td> <b>Default:</b><br><div style="color: blue">127.0.0.1</div> </td> <td> <div>A resolvable hostname or IP address to wait for.</div> </td> </tr> <tr> <td colspan="1"> <b>msg</b> <br><div style="font-size: small; color: darkgreen">(added in 2.4)</div> </td> <td> </td> <td> <div>This overrides the normal error message from a failure to meet the required conditions.</div> </td> </tr> <tr> <td colspan="1"> <b>path</b> <br><div style="font-size: small; color: darkgreen">(added in 1.4)</div> </td> <td> </td> <td> <div>Path to a file on the filesystem that must exist before continuing.</div> </td> </tr> <tr> <td colspan="1"> <b>port</b> </td> <td> </td> <td> <div>Port number to poll.</div> </td> </tr> <tr> <td colspan="1"> <b>search_regex</b> <br><div style="font-size: small; color: darkgreen">(added in 1.4)</div> </td> <td> </td> <td> <div>Can be used to match a string in either a file or a socket connection.</div> <div>Defaults to a multiline regex.</div> </td> </tr> <tr> <td colspan="1"> <b>sleep</b> <br><div style="font-size: small; color: darkgreen">(added in 2.3)</div> </td> <td> <b>Default:</b><br><div style="color: blue">1</div> </td> <td> <div>Number of seconds to sleep between checks, before 2.3 this was hardcoded to 1 second.</div> </td> </tr> <tr> <td colspan="1"> <b>state</b> </td> <td> <ul>
<b>Choices:</b> <li>absent</li> <li>drained</li> <li>present</li> <li><div style="color: blue">
<b>started</b> ←</div></li> <li>stopped</li> </ul> </td> <td> <div>Either <code>present</code>, <code>started</code>, or <code>stopped</code>, <code>absent</code>, or <code>drained</code>.</div> <div>When checking a port <code>started</code> will ensure the port is open, <code>stopped</code> will check that it is closed, <code>drained</code> will check for active connections.</div> <div>When checking for a file or a search string <code>present</code> or <code>started</code> will ensure that the file or string is present before continuing, <code>absent</code> will check that file is absent or removed.</div> </td> </tr> <tr> <td colspan="1"> <b>timeout</b> </td> <td> <b>Default:</b><br><div style="color: blue">300</div> </td> <td> <div>Maximum number of seconds to wait for, when used with another condition it will force an error.</div> <div>When used without other conditions it is equivalent of just sleeping.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="first admonition-title">Note</p> <ul class="last simple"> <li>The ability to use search_regex with a port connection was added in 1.7.</li> <li>Prior to 2.4, testing for the absense of a directory or UNIX socket did not work correctly.</li> <li>Prior to 2.4, testing for the presence of a file did not work correctly if the remote user did not have read access to that file.</li> <li>Under some circumstances when using mandatory access control, a path may always be treated as being absent even if it exists, but can’t be modified or created by the remote user either.</li> <li>When waiting for a path, symbolic links will be followed. Many other modules that manipulate files do not follow symbolic links, so operations on the path using other modules may not work exactly as expected.</li> <li>This module is also supported for Windows targets.</li> <li>See also <a class="reference internal" href="../wait_for_connection_module/#wait-for-connection-module"><span class="std std-ref">wait_for_connection</span></a>
</li> </ul> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml">- name: sleep for 300 seconds and continue with play
  wait_for: timeout=300
  delegate_to: localhost

- name: Wait for port 8000 to become open on the host, don't start checking for 10 seconds
  wait_for:
    port: 8000
    delay: 10

- name: Waits for port 8000 of any IP to close active connections, don't start checking for 10 seconds
  wait_for:
    host: 0.0.0.0
    port: 8000
    delay: 10
    state: drained

- name: Wait for port 8000 of any IP to close active connections, ignoring connections for specified hosts
  wait_for:
    host: 0.0.0.0
    port: 8000
    state: drained
    exclude_hosts: 10.2.1.2,10.2.1.3

- name: Wait until the file /tmp/foo is present before continuing
  wait_for:
    path: /tmp/foo

- name: Wait until the string "completed" is in the file /tmp/foo before continuing
  wait_for:
    path: /tmp/foo
    search_regex: completed

- name: Wait until the lock file is removed
  wait_for:
    path: /var/lock/file.lock
    state: absent

- name: Wait until the process is finished and pid was destroyed
  wait_for:
    path: /proc/3466/status
    state: absent

- name: Output customized message when failed
  wait_for:
    path: /tmp/foo
    state: present
    msg: Timeout to find file /tmp/foo

# Don't assume the inventory_hostname is resolvable and delay 10 seconds at start
- name: Wait 300 seconds for port 22 to become open and contain "OpenSSH"
  wait_for:
    port: 22
    host: '{{ (ansible_ssh_host|default(ansible_host))|default(inventory_hostname) }}'
    search_regex: OpenSSH
    delay: 10
  connection: local

# Same as above but you normally have ansible_connection set in inventory, which overrides 'connection'
- name: Wait 300 seconds for port 22 to become open and contain "OpenSSH"
  wait_for:
    port: 22
    host: '{{ (ansible_ssh_host|default(ansible_host))|default(inventory_hostname) }}'
    search_regex: OpenSSH
    delay: 10
  vars:
    ansible_connection: local
</pre>   <h2 id="status">Status</h2> <p>This module is flagged as <strong>stableinterface</strong> which means that the maintainers for this module guarantee that no backward incompatible interface changes will be made.</p>   <h2 id="maintenance">Maintenance</h2> <p>This module is flagged as <strong>core</strong> which means that it is maintained by the Ansible Core Team. See <a class="reference internal" href="../../user_guide/modules_support/#modules-support"><span class="std std-ref">Module Maintenance &amp; Support</span></a> for more info.</p> <p>For a list of other modules that are also maintained by the Ansible Core Team, see <a class="reference internal" href="../core_maintained/#core-supported"><span class="std std-ref">here</span></a>.</p>  <h3 id="support">Support</h3> <p>For more information about Red Hat’s support of this module, please refer to this <a class="reference external" href="https://access.redhat.com/articles/rhel-top-support-policies/" target="_blank">Knowledge Base article</a></p>   <h3 id="author">Author</h3> <ul class="simple"> <li>Jeroen Hoekx (@jhoekx)</li> <li>John Jarvis (@jarv)</li> <li>Andrii Radyk (@AnderEnder)</li> </ul> <div class="admonition hint"> <p class="first admonition-title">Hint</p> <p class="last">If you notice any issues in this documentation you can <a class="reference external" href="https://github.com/ansible/ansible/edit/devel/lib/ansible/modules/utilities/logic/wait_for.py?description=%3C!---%20Your%20description%20here%20--%3E%0A%0A%2Blabel:%20docsite_pr" target="_blank">edit this document</a> to improve it.</p> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2012–2018 Michael DeHaan<br>© 2018 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/2.7/modules/wait_for_module.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/2.7/modules/wait_for_module.html</a>
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
