
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Universal Class Loader - Phalcon 2 - W3cubDocs</title>
  
  <meta name="description" content="Phalcon&#92;Loader is a component that allows you to load project classes automatically, based on some predefined rules. Since this component is &hellip;">
  <meta name="keywords" content="universal, class, loader, -, phalcon, phalcon~2">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/phalcon~2/reference/loader/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/phalcon~2.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/phalcon~2/" class="_nav-link" title="" style="margin-left:0;">Phalcon 2</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _phalcon">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1 id="universal-class-loader">Universal Class Loader</h1> <p><a class="reference internal" href="../../api/phalcon_loader/"><em>Phalcon\Loader</em></a> is a component that allows you to load project classes automatically, based on some predefined rules. Since this component is written in C, it provides the lowest overhead in reading and interpreting external PHP files.</p> <p>The behavior of this component is based on the PHP’s capability of <a class="reference external" href="http://www.php.net/manual/en/language.oop5.autoload.php" target="_blank">autoloading classes</a>. If a class that does not exist is used in any part of the code, a special handler will try to load it. <a class="reference internal" href="../../api/phalcon_loader/"><em>Phalcon\Loader</em></a> serves as the special handler for this operation. By loading classes on a need to load basis, the overall performance is increased since the only file reads that occur are for the files needed. This technique is called <a class="reference external" href="http://en.wikipedia.org/wiki/Lazy_initialization" target="_blank">lazy initialization</a>.</p> <p>With this component you can load files from other projects or vendors, this autoloader is <a class="reference external" href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-0.md" target="_blank">PSR-0</a> compliant.</p> <p><a class="reference internal" href="../../api/phalcon_loader/"><em>Phalcon\Loader</em></a> offers four options to autoload classes. You can use them one at a time or combine them.</p>  <h2 id="registering-namespaces">Registering Namespaces</h2> <p>If you’re organizing your code using namespaces, or external libraries do so, the registerNamespaces() provides the autoloading mechanism. It takes an associative array, which keys are namespace prefixes and their values are directories where the classes are located in. The namespace separator will be replaced by the directory separator when the loader try to find the classes. Remember always to add a trailing slash at the end of the paths.</p> <pre class="highlight-php" data-language="php">// Creates the autoloader
$loader = new \Phalcon\Loader();

//Register some namespaces
$loader-&gt;registerNamespaces(
    array(
       "Example\Base"    =&gt; "vendor/example/base/",
       "Example\Adapter" =&gt; "vendor/example/adapter/",
       "Example"         =&gt; "vendor/example/",
    )
);

// register autoloader
$loader-&gt;register();

// The required class will automatically include the
// file vendor/example/adapter/Some.php
$some = new Example\Adapter\Some();
</pre>   <h2 id="registering-prefixes">Registering Prefixes</h2> <p>This strategy is similar to the namespaces strategy. It takes an associative array, which keys are prefixes and their values are directories where the classes are located in. The namespace separator and the “_” underscore character will be replaced by the directory separator when the loader try to find the classes. Remember always to add a trailing slash at the end of the paths.</p> <pre class="highlight-php" data-language="php">// Creates the autoloader
$loader = new \Phalcon\Loader();

//Register some prefixes
$loader-&gt;registerPrefixes(
    array(
       "Example_Base"     =&gt; "vendor/example/base/",
       "Example_Adapter"  =&gt; "vendor/example/adapter/",
       "Example_"         =&gt; "vendor/example/",
    )
);

// register autoloader
$loader-&gt;register();

// The required class will automatically include the
// file vendor/example/adapter/Some.php
$some = new Example_Adapter_Some();
</pre>   <h2 id="registering-directories">Registering Directories</h2> <p>The third option is to register directories, in which classes could be found. This option is not recommended in terms of performance, since Phalcon will need to perform a significant number of file stats on each folder, looking for the file with the same name as the class. It’s important to register the directories in relevance order. Remember always add a trailing slash at the end of the paths.</p> <pre class="highlight-php" data-language="php">// Creates the autoloader
$loader = new \Phalcon\Loader();

// Register some directories
$loader-&gt;registerDirs(
    array(
        "library/MyComponent/",
        "library/OtherComponent/Other/",
        "vendor/example/adapters/",
        "vendor/example/"
    )
);

// register autoloader
$loader-&gt;register();

// The required class will automatically include the file from
// the first directory where it has been located
// i.e. library/OtherComponent/Other/Some.php
$some = new Some();
</pre>   <h2 id="registering-classes">Registering Classes</h2> <p>The last option is to register the class name and its path. This autoloader can be very useful when the folder convention of the project does not allow for easy retrieval of the file using the path and the class name. This is the fastest method of autoloading. However the more your application grows, the more classes/files need to be added to this autoloader, which will effectively make maintenance of the class list very cumbersome and it is not recommended.</p> <pre class="highlight-php" data-language="php">// Creates the autoloader
$loader = new \Phalcon\Loader();

// Register some classes
$loader-&gt;registerClasses(
    array(
        "Some"         =&gt; "library/OtherComponent/Other/Some.php",
        "Example\Base" =&gt; "vendor/example/adapters/Example/BaseClass.php",
    )
);

// register autoloader
$loader-&gt;register();

// Requiring a class will automatically include the file it references
// in the associative array
// i.e. library/OtherComponent/Other/Some.php
$some = new Some();
</pre>   <h2 id="additional-file-extensions">Additional file extensions</h2> <p>Some autoloading strategies such as “prefixes”, “namespaces” or “directories” automatically append the “php” extension at the end of the checked file. If you are using additional extensions you could set it with the method “setExtensions”. Files are checked in the order as it were defined:</p> <pre class="highlight-php" data-language="php">// Creates the autoloader
$loader = new \Phalcon\Loader();

//Set file extensions to check
$loader-&gt;setExtensions(array("php", "inc", "phb"));
</pre>   <h2 id="modifying-current-strategies">Modifying current strategies</h2> <p>Additional auto-loading data can be added to existing values in the following way:</p> <pre class="highlight-php" data-language="php">// Adding more directories
$loader-&gt;registerDirs(
    array(
        "../app/library/",
        "../app/plugins/"
    ),
    true
);
</pre> <p>Passing “true” as second parameter will merge the current values with new ones in any strategy.</p>   <h2 id="security-layer">Security Layer</h2> <p>Phalcon\Loader offers a security layer sanitizing by default class names avoiding possible inclusion of unauthorized files. Consider the following example:</p> <pre class="highlight-php" data-language="php">//Basic autoloader
spl_autoload_register(function($className) {
    if (file_exists($className . '.php')) {
        require $className . '.php';
    }
});
</pre> <p>The above auto-loader lacks of any security check, if by mistake in a function that launch the auto-loader, a malicious prepared string is used as parameter this would allow to execute any file accessible by the application:</p> <pre class="highlight-php" data-language="php">//This variable is not filtered and comes from an insecure source
$className = '../processes/important-process';

//Check if the class exists triggering the auto-loader
if (class_exists($className)) {
    //...
}
</pre> <p>If ‘../processes/important-process.php’ is a valid file, an external user could execute the file without authorization.</p> <p>To avoid these or most sophisticated attacks, Phalcon\Loader removes any invalid character from the class name reducing the possibility of being attacked.</p>   <h2 id="autoloading-events">Autoloading Events</h2> <p>In the following example, the EventsManager is working with the class loader, allowing us to obtain debugging information regarding the flow of operation:</p> <pre class="highlight-php" data-language="php">$eventsManager = new \Phalcon\Events\Manager();

$loader = new \Phalcon\Loader();

$loader-&gt;registerNamespaces(array(
   'Example\\Base' =&gt; 'vendor/example/base/',
   'Example\\Adapter' =&gt; 'vendor/example/adapter/',
   'Example' =&gt; 'vendor/example/'
));

//Listen all the loader events
$eventsManager-&gt;attach('loader', function($event, $loader) {
    if ($event-&gt;getType() == 'beforeCheckPath') {
        echo $loader-&gt;getCheckedPath();
    }
});

$loader-&gt;setEventsManager($eventsManager);

$loader-&gt;register();
</pre> <p>Some events when returning boolean false could stop the active operation. The following events are supported:</p> <table class="docutils"> <colgroup> <col width="12%"> <col width="38%"> <col width="37%"> <col width="14%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Event Name</th> <th class="head" colspan="2">Triggered</th> <th class="head">Can stop operation?</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td>beforeCheckClass</td> <td colspan="2">Triggered before starting the autoloading process</td> <td>Yes</td> </tr> <tr class="row-odd">
<td>pathFound</td> <td colspan="2">Triggered when the loader locate a class</td> <td>No</td> </tr> <tr class="row-even">
<td>afterCheckClass</td> <td colspan="2">Triggered after finish the autoloading process. If this event is launched the autoloader didn’t find the class file</td> <td>No</td> </tr> </tbody> </table>   <h2 id="troubleshooting">Troubleshooting</h2> <p>Some things to keep in mind when using the universal autoloader:</p> <ul class="simple"> <li>Auto-loading process is case-sensitive, the class will be loaded as it is written in the code</li> <li>Strategies based on namespaces/prefixes are faster than the directories strategy</li> <li>If a cache bytecode like <a class="reference external" href="http://php.net/manual/en/book.apc.php" target="_blank">APC</a> is installed this will used to retrieve the requested file (an implicit caching of the file is performed)</li> </ul>
<div class="_attribution">
  <p class="_attribution-p">
    © 2011–2016 Phalcon Framework Team<br>Licensed under the Creative Commons Attribution License 3.0.<br>
    <a href="https://docs.phalconphp.com/en/2.0.0/reference/loader.html" class="_attribution-link" target="_blank">https://docs.phalconphp.com/en/2.0.0/reference/loader.html</a>
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
