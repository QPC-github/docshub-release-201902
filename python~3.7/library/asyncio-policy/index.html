
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Policies - Python 3.7 - W3cubDocs</title>
  
  <meta name="description" content="An event loop policy is a global per-process object that controls the management of the event loop. Each event loop has a default policy, which can &hellip;">
  <meta name="keywords" content="policies, -, python, python~3.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/python~3.7/library/asyncio-policy/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/python~3.7.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/python~3.7/" class="_nav-link" title="" style="margin-left:0;">Python 3.7</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _python">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1 id="asyncio-policies">Policies</h1> <p id="policies">An event loop policy is a global per-process object that controls the management of the event loop. Each event loop has a default policy, which can be changed and customized using the policy API.</p> <p>A policy defines the notion of <em>context</em> and manages a separate event loop per context. The default policy defines <em>context</em> to be the current thread.</p> <p>By using a custom event loop policy, the behavior of <a class="reference internal" href="../asyncio-eventloop/#asyncio.get_event_loop" title="asyncio.get_event_loop"><code>get_event_loop()</code></a>, <a class="reference internal" href="../asyncio-eventloop/#asyncio.set_event_loop" title="asyncio.set_event_loop"><code>set_event_loop()</code></a>, and <a class="reference internal" href="../asyncio-eventloop/#asyncio.new_event_loop" title="asyncio.new_event_loop"><code>new_event_loop()</code></a> functions can be customized.</p> <p>Policy objects should implement the APIs defined in the <a class="reference internal" href="#asyncio.AbstractEventLoopPolicy" title="asyncio.AbstractEventLoopPolicy"><code>AbstractEventLoopPolicy</code></a> abstract base class.</p>  <h2 id="getting-and-setting-the-policy">Getting and Setting the Policy</h2> <p>The following functions can be used to get and set the policy for the current process:</p> <dl class="function"> <dt id="asyncio.get_event_loop_policy">
<code>asyncio.get_event_loop_policy()</code> </dt> <dd>
<p>Return the current process-wide policy.</p> </dd>
</dl> <dl class="function"> <dt id="asyncio.set_event_loop_policy">
<code>asyncio.set_event_loop_policy(policy)</code> </dt> <dd>
<p>Set the current process-wide policy to <em>policy</em>.</p> <p>If <em>policy</em> is set to <code>None</code>, the default policy is restored.</p> </dd>
</dl>   <h2 id="policy-objects">Policy Objects</h2> <p>The abstract event loop policy base class is defined as follows:</p> <dl class="class"> <dt id="asyncio.AbstractEventLoopPolicy">
<code>class asyncio.AbstractEventLoopPolicy</code> </dt> <dd>
<p>An abstract base class for asyncio policies.</p> <dl class="method"> <dt id="asyncio.AbstractEventLoopPolicy.get_event_loop">
<code>get_event_loop()</code> </dt> <dd>
<p>Get the event loop for the current context.</p> <p>Return an event loop object implementing the <a class="reference internal" href="../asyncio-eventloop/#asyncio.AbstractEventLoop" title="asyncio.AbstractEventLoop"><code>AbstractEventLoop</code></a> interface.</p> <p>This method should never return <code>None</code>.</p> <div class="versionchanged"> <p><span class="versionmodified">Changed in version 3.6.</span></p> </div> </dd>
</dl> <dl class="method"> <dt id="asyncio.AbstractEventLoopPolicy.set_event_loop">
<code>set_event_loop(loop)</code> </dt> <dd>
<p>Set the event loop for the current context to <em>loop</em>.</p> </dd>
</dl> <dl class="method"> <dt id="asyncio.AbstractEventLoopPolicy.new_event_loop">
<code>new_event_loop()</code> </dt> <dd>
<p>Create and return a new event loop object.</p> <p>This method should never return <code>None</code>.</p> </dd>
</dl> <dl class="method"> <dt id="asyncio.AbstractEventLoopPolicy.get_child_watcher">
<code>get_child_watcher()</code> </dt> <dd>
<p>Get a child process watcher object.</p> <p>Return a watcher object implementing the <a class="reference internal" href="#asyncio.AbstractChildWatcher" title="asyncio.AbstractChildWatcher"><code>AbstractChildWatcher</code></a> interface.</p> <p>This function is Unix specific.</p> </dd>
</dl> <dl class="method"> <dt id="asyncio.AbstractEventLoopPolicy.set_child_watcher">
<code>set_child_watcher(watcher)</code> </dt> <dd>
<p>Get the current child process watcher to <em>watcher</em>.</p> <p>This function is Unix specific.</p> </dd>
</dl> </dd>
</dl> <p>asyncio ships with the following built-in policies:</p> <dl class="class"> <dt id="asyncio.DefaultEventLoopPolicy">
<code>class asyncio.DefaultEventLoopPolicy</code> </dt> <dd>
<p>The default asyncio policy. Uses <a class="reference internal" href="../asyncio-eventloop/#asyncio.SelectorEventLoop" title="asyncio.SelectorEventLoop"><code>SelectorEventLoop</code></a> on both Unix and Windows platforms.</p> <p>There is no need to install the default policy manually. asyncio is configured to use the default policy automatically.</p> </dd>
</dl> <dl class="class"> <dt id="asyncio.WindowsProactorEventLoopPolicy">
<code>class asyncio.WindowsProactorEventLoopPolicy</code> </dt> <dd>
<p>An alternative event loop policy that uses the <a class="reference internal" href="../asyncio-eventloop/#asyncio.ProactorEventLoop" title="asyncio.ProactorEventLoop"><code>ProactorEventLoop</code></a> event loop implementation.</p> <p>Availability: Windows.</p> </dd>
</dl>   <h2 id="process-watchers">Process Watchers</h2> <p>A process watcher allows customization of how an event loop monitors child processes on Unix. Specifically, the event loop needs to know when a child process has exited.</p> <p>In asyncio, child processes are created with <a class="reference internal" href="../asyncio-subprocess/#asyncio.create_subprocess_exec" title="asyncio.create_subprocess_exec"><code>create_subprocess_exec()</code></a> and <a class="reference internal" href="../asyncio-eventloop/#asyncio.loop.subprocess_exec" title="asyncio.loop.subprocess_exec"><code>loop.subprocess_exec()</code></a> functions.</p> <p>asyncio defines the <a class="reference internal" href="#asyncio.AbstractChildWatcher" title="asyncio.AbstractChildWatcher"><code>AbstractChildWatcher</code></a> abstract base class, which child watchers should implement, and has two different implementations: <a class="reference internal" href="#asyncio.SafeChildWatcher" title="asyncio.SafeChildWatcher"><code>SafeChildWatcher</code></a> (configured to be used by default) and <a class="reference internal" href="#asyncio.FastChildWatcher" title="asyncio.FastChildWatcher"><code>FastChildWatcher</code></a>.</p> <p>See also the <a class="reference internal" href="../asyncio-subprocess/#asyncio-subprocess-threads"><span class="std std-ref">Subprocess and Threads</span></a> section.</p> <p>The following two functions can be used to customize the child process watcher implementation used by the asyncio event loop:</p> <dl class="function"> <dt id="asyncio.get_child_watcher">
<code>asyncio.get_child_watcher()</code> </dt> <dd>
<p>Return the current child watcher for the current policy.</p> </dd>
</dl> <dl class="function"> <dt id="asyncio.set_child_watcher">
<code>asyncio.set_child_watcher(watcher)</code> </dt> <dd>
<p>Set the current child watcher to <em>watcher</em> for the current policy. <em>watcher</em> must implement methods defined in the <a class="reference internal" href="#asyncio.AbstractChildWatcher" title="asyncio.AbstractChildWatcher"><code>AbstractChildWatcher</code></a> base class.</p> </dd>
</dl> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Third-party event loops implementations might not support custom child watchers. For such event loops, using <a class="reference internal" href="#asyncio.set_child_watcher" title="asyncio.set_child_watcher"><code>set_child_watcher()</code></a> might be prohibited or have no effect.</p> </div> <dl class="class"> <dt id="asyncio.AbstractChildWatcher">
<code>class asyncio.AbstractChildWatcher</code> </dt> <dd>
<dl class="method"> <dt id="asyncio.AbstractChildWatcher.add_child_handler">
<code>add_child_handler(pid, callback, *args)</code> </dt> <dd>
<p>Register a new child handler.</p> <p>Arrange for <code>callback(pid, returncode, *args)</code> to be called when a process with PID equal to <em>pid</em> terminates. Specifying another callback for the same process replaces the previous handler.</p> <p>The <em>callback</em> callable must be thread-safe.</p> </dd>
</dl> <dl class="method"> <dt id="asyncio.AbstractChildWatcher.remove_child_handler">
<code>remove_child_handler(pid)</code> </dt> <dd>
<p>Removes the handler for process with PID equal to <em>pid</em>.</p> <p>The function returns <code>True</code> if the handler was successfully removed, <code>False</code> if there was nothing to remove.</p> </dd>
</dl> <dl class="method"> <dt id="asyncio.AbstractChildWatcher.attach_loop">
<code>attach_loop(loop)</code> </dt> <dd>
<p>Attach the watcher to an event loop.</p> <p>If the watcher was previously attached to an event loop, then it is first detached before attaching to the new loop.</p> <p>Note: loop may be <code>None</code>.</p> </dd>
</dl> <dl class="method"> <dt id="asyncio.AbstractChildWatcher.close">
<code>close()</code> </dt> <dd>
<p>Close the watcher.</p> <p>This method has to be called to ensure that underlying resources are cleaned-up.</p> </dd>
</dl> </dd>
</dl> <dl class="class"> <dt id="asyncio.SafeChildWatcher">
<code>class asyncio.SafeChildWatcher</code> </dt> <dd>
<p>This implementation avoids disrupting other code spawning processes by polling every process explicitly on a <code>SIGCHLD</code> signal.</p> <p>This is a safe solution but it has a significant overhead when handling a big number of processes (<em>O(n)</em> each time a <code>SIGCHLD</code> is received).</p> <p>asyncio uses this safe implementation by default.</p> </dd>
</dl> <dl class="class"> <dt id="asyncio.FastChildWatcher">
<code>class asyncio.FastChildWatcher</code> </dt> <dd>
<p>This implementation reaps every terminated processes by calling <code>os.waitpid(-1)</code> directly, possibly breaking other code spawning processes and waiting for their termination.</p> <p>There is no noticeable overhead when handling a big number of children (<em>O(1)</em> each time a child terminates).</p> </dd>
</dl>   <h2 id="custom-policies">Custom Policies</h2> <p>To implement a new event loop policy, it is recommended to subclass <a class="reference internal" href="#asyncio.DefaultEventLoopPolicy" title="asyncio.DefaultEventLoopPolicy"><code>DefaultEventLoopPolicy</code></a> and override the methods for which custom behavior is wanted, e.g.:</p> <pre data-language="python">class MyEventLoopPolicy(asyncio.DefaultEventLoopPolicy):

    def get_event_loop(self):
        """Get the event loop.

        This may be None or an instance of EventLoop.
        """
        loop = super().get_event_loop()
        # Do something with loop ...
        return loop

asyncio.set_event_loop_policy(MyEventLoopPolicy())
</pre>
<div class="_attribution">
  <p class="_attribution-p">
    © 2001–2018 Python Software Foundation<br>Licensed under the PSF License.<br>
    <a href="https://docs.python.org/3.7/library/asyncio-policy.html" class="_attribution-link" target="_blank">https://docs.python.org/3.7/library/asyncio-policy.html</a>
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
