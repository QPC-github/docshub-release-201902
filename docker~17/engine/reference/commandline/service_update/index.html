
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Docker Service Update - Docker 17 - W3cubDocs</title>
  
  <meta name="description" content=" Update a service ">
  <meta name="keywords" content="docker, service, update, -, docker~17">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/docker~17/engine/reference/commandline/service_update/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/docker~17.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/docker~17/" class="_nav-link" title="" style="margin-left:0;">Docker 17</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _simple">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档开头内嵌 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="8852552735"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				
<h1>docker service update</h1>    <h2 id="description">Description</h2> <p>Update a service</p> <h2 id="usage">Usage</h2> <pre data-language="">docker service update [OPTIONS] SERVICE
</pre> <h2 id="options">Options</h2> <table> <thead> <tr> <th>Name, shorthand</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="highlighter-rouge">--args</code></td> <td> </td> <td>Service command args</td> </tr> <tr> <td><code class="highlighter-rouge">--config-add</code></td> <td> </td> <td>Add or update a config file on a service</td> </tr> <tr> <td><code class="highlighter-rouge">--config-rm</code></td> <td> </td> <td>Remove a configuration file</td> </tr> <tr> <td><code class="highlighter-rouge">--constraint-add</code></td> <td> </td> <td>Add or update a placement constraint</td> </tr> <tr> <td><code class="highlighter-rouge">--constraint-rm</code></td> <td> </td> <td>Remove a constraint</td> </tr> <tr> <td><code class="highlighter-rouge">--container-label-add</code></td> <td> </td> <td>Add or update a container label</td> </tr> <tr> <td><code class="highlighter-rouge">--container-label-rm</code></td> <td> </td> <td>Remove a container label by its key</td> </tr> <tr> <td><code class="highlighter-rouge">--credential-spec</code></td> <td> </td> <td>Credential spec for managed service account (Windows only)</td> </tr> <tr> <td><code class="highlighter-rouge">--detach, -d</code></td> <td><code class="highlighter-rouge">true</code></td> <td>Exit immediately instead of waiting for the service to converge</td> </tr> <tr> <td><code class="highlighter-rouge">--dns-add</code></td> <td> </td> <td>Add or update a custom DNS server</td> </tr> <tr> <td><code class="highlighter-rouge">--dns-option-add</code></td> <td> </td> <td>Add or update a DNS option</td> </tr> <tr> <td><code class="highlighter-rouge">--dns-option-rm</code></td> <td> </td> <td>Remove a DNS option</td> </tr> <tr> <td><code class="highlighter-rouge">--dns-rm</code></td> <td> </td> <td>Remove a custom DNS server</td> </tr> <tr> <td><code class="highlighter-rouge">--dns-search-add</code></td> <td> </td> <td>Add or update a custom DNS search domain</td> </tr> <tr> <td><code class="highlighter-rouge">--dns-search-rm</code></td> <td> </td> <td>Remove a DNS search domain</td> </tr> <tr> <td><code class="highlighter-rouge">--endpoint-mode</code></td> <td> </td> <td>Endpoint mode (vip or dnsrr)</td> </tr> <tr> <td><code class="highlighter-rouge">--entrypoint</code></td> <td> </td> <td>Overwrite the default ENTRYPOINT of the image</td> </tr> <tr> <td><code class="highlighter-rouge">--env-add</code></td> <td> </td> <td>Add or update an environment variable</td> </tr> <tr> <td><code class="highlighter-rouge">--env-rm</code></td> <td> </td> <td>Remove an environment variable</td> </tr> <tr> <td><code class="highlighter-rouge">--force</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Force update even if no changes require it</td> </tr> <tr> <td><code class="highlighter-rouge">--group-add</code></td> <td> </td> <td>Add an additional supplementary user group to the container</td> </tr> <tr> <td><code class="highlighter-rouge">--group-rm</code></td> <td> </td> <td>Remove a previously added supplementary user group from the container</td> </tr> <tr> <td><code class="highlighter-rouge">--health-cmd</code></td> <td> </td> <td>Command to run to check health</td> </tr> <tr> <td><code class="highlighter-rouge">--health-interval</code></td> <td> </td> <td>Time between running the check (ms|s|m|h)</td> </tr> <tr> <td><code class="highlighter-rouge">--health-retries</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Consecutive failures needed to report unhealthy</td> </tr> <tr> <td><code class="highlighter-rouge">--health-start-period</code></td> <td> </td> <td>Start period for the container to initialize before counting retries towards unstable (ms|s|m|h)</td> </tr> <tr> <td><code class="highlighter-rouge">--health-timeout</code></td> <td> </td> <td>Maximum time to allow one check to run (ms|s|m|h)</td> </tr> <tr> <td><code class="highlighter-rouge">--host-add</code></td> <td> </td> <td>Add or update a custom host-to-IP mapping (host:ip)</td> </tr> <tr> <td><code class="highlighter-rouge">--host-rm</code></td> <td> </td> <td>Remove a custom host-to-IP mapping (host:ip)</td> </tr> <tr> <td><code class="highlighter-rouge">--hostname</code></td> <td> </td> <td>Container hostname</td> </tr> <tr> <td><code class="highlighter-rouge">--image</code></td> <td> </td> <td>Service image tag</td> </tr> <tr> <td><code class="highlighter-rouge">--label-add</code></td> <td> </td> <td>Add or update a service label</td> </tr> <tr> <td><code class="highlighter-rouge">--label-rm</code></td> <td> </td> <td>Remove a label by its key</td> </tr> <tr> <td><code class="highlighter-rouge">--limit-cpu</code></td> <td> </td> <td>Limit CPUs</td> </tr> <tr> <td><code class="highlighter-rouge">--limit-memory</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Limit Memory</td> </tr> <tr> <td><code class="highlighter-rouge">--log-driver</code></td> <td> </td> <td>Logging driver for service</td> </tr> <tr> <td><code class="highlighter-rouge">--log-opt</code></td> <td> </td> <td>Logging driver options</td> </tr> <tr> <td><code class="highlighter-rouge">--mount-add</code></td> <td> </td> <td>Add or update a mount on a service</td> </tr> <tr> <td><code class="highlighter-rouge">--mount-rm</code></td> <td> </td> <td>Remove a mount by its target path</td> </tr> <tr> <td><code class="highlighter-rouge">--network-add</code></td> <td> </td> <td>Add a network</td> </tr> <tr> <td><code class="highlighter-rouge">--network-rm</code></td> <td> </td> <td>Remove a network</td> </tr> <tr> <td><code class="highlighter-rouge">--no-healthcheck</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Disable any container-specified HEALTHCHECK</td> </tr> <tr> <td><code class="highlighter-rouge">--no-resolve-image</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Do not query the registry to resolve image digest and supported platforms</td> </tr> <tr> <td><code class="highlighter-rouge">--placement-pref-add</code></td> <td> </td> <td>Add a placement preference</td> </tr> <tr> <td><code class="highlighter-rouge">--placement-pref-rm</code></td> <td> </td> <td>Remove a placement preference</td> </tr> <tr> <td><code class="highlighter-rouge">--publish-add</code></td> <td> </td> <td>Add or update a published port</td> </tr> <tr> <td><code class="highlighter-rouge">--publish-rm</code></td> <td> </td> <td>Remove a published port by its target port</td> </tr> <tr> <td><code class="highlighter-rouge">--quiet, -q</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Suppress progress output</td> </tr> <tr> <td><code class="highlighter-rouge">--read-only</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Mount the container’s root filesystem as read only</td> </tr> <tr> <td><code class="highlighter-rouge">--replicas</code></td> <td> </td> <td>Number of tasks</td> </tr> <tr> <td><code class="highlighter-rouge">--reserve-cpu</code></td> <td> </td> <td>Reserve CPUs</td> </tr> <tr> <td><code class="highlighter-rouge">--reserve-memory</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Reserve Memory</td> </tr> <tr> <td><code class="highlighter-rouge">--restart-condition</code></td> <td> </td> <td>Restart when condition is met (“none”|“on-failure”|“any”)</td> </tr> <tr> <td><code class="highlighter-rouge">--restart-delay</code></td> <td> </td> <td>Delay between restart attempts (ns|us|ms|s|m|h)</td> </tr> <tr> <td><code class="highlighter-rouge">--restart-max-attempts</code></td> <td> </td> <td>Maximum number of restarts before giving up</td> </tr> <tr> <td><code class="highlighter-rouge">--restart-window</code></td> <td> </td> <td>Window used to evaluate the restart policy (ns|us|ms|s|m|h)</td> </tr> <tr> <td><code class="highlighter-rouge">--rollback</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Rollback to previous specification</td> </tr> <tr> <td><code class="highlighter-rouge">--rollback-delay</code></td> <td><code class="highlighter-rouge">0s</code></td> <td>Delay between task rollbacks (ns|us|ms|s|m|h)</td> </tr> <tr> <td><code class="highlighter-rouge">--rollback-failure-action</code></td> <td> </td> <td>Action on rollback failure (“pause”|“continue”)</td> </tr> <tr> <td><code class="highlighter-rouge">--rollback-max-failure-ratio</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Failure rate to tolerate during a rollback</td> </tr> <tr> <td><code class="highlighter-rouge">--rollback-monitor</code></td> <td><code class="highlighter-rouge">0s</code></td> <td>Duration after each task rollback to monitor for failure (ns|us|ms|s|m|h)</td> </tr> <tr> <td><code class="highlighter-rouge">--rollback-order</code></td> <td> </td> <td>Rollback order (“start-first”|“stop-first”)</td> </tr> <tr> <td><code class="highlighter-rouge">--rollback-parallelism</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Maximum number of tasks rolled back simultaneously (0 to roll back all at once)</td> </tr> <tr> <td><code class="highlighter-rouge">--secret-add</code></td> <td> </td> <td>Add or update a secret on a service</td> </tr> <tr> <td><code class="highlighter-rouge">--secret-rm</code></td> <td> </td> <td>Remove a secret</td> </tr> <tr> <td><code class="highlighter-rouge">--stop-grace-period</code></td> <td> </td> <td>Time to wait before force killing a container (ns|us|ms|s|m|h)</td> </tr> <tr> <td><code class="highlighter-rouge">--stop-signal</code></td> <td> </td> <td>Signal to stop the container</td> </tr> <tr> <td><code class="highlighter-rouge">--tty, -t</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Allocate a pseudo-TTY</td> </tr> <tr> <td><code class="highlighter-rouge">--update-delay</code></td> <td><code class="highlighter-rouge">0s</code></td> <td>Delay between updates (ns|us|ms|s|m|h)</td> </tr> <tr> <td><code class="highlighter-rouge">--update-failure-action</code></td> <td> </td> <td>Action on update failure (“pause”|“continue”|“rollback”)</td> </tr> <tr> <td><code class="highlighter-rouge">--update-max-failure-ratio</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Failure rate to tolerate during an update</td> </tr> <tr> <td><code class="highlighter-rouge">--update-monitor</code></td> <td><code class="highlighter-rouge">0s</code></td> <td>Duration after each task update to monitor for failure (ns|us|ms|s|m|h)</td> </tr> <tr> <td><code class="highlighter-rouge">--update-order</code></td> <td> </td> <td>Update order (“start-first”|“stop-first”)</td> </tr> <tr> <td><code class="highlighter-rouge">--update-parallelism</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Maximum number of tasks updated simultaneously (0 to update all at once)</td> </tr> <tr> <td><code class="highlighter-rouge">--user, -u</code></td> <td> </td> <td>Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])</td> </tr> <tr> <td><code class="highlighter-rouge">--with-registry-auth</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Send registry authentication details to swarm agents</td> </tr> <tr> <td><code class="highlighter-rouge">--workdir, -w</code></td> <td> </td> <td>Working directory inside the container</td> </tr> </tbody> </table> <h2 id="parent-command">Parent command</h2> <table> <thead> <tr> <th>Command</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><a href="../service/">docker service</a></td> <td>Manage services</td> </tr> </tbody> </table> <h2 id="related-commands">Related commands</h2> <table> <thead> <tr> <th>Command</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><a href="../service_create/">docker service create</a></td> <td>Create a new service</td> </tr> <tr> <td><a href="../service_inspect/">docker service inspect</a></td> <td>Display detailed information on one or more services</td> </tr> <tr> <td><a href="../service_logs/">docker service logs</a></td> <td>Fetch the logs of a service or task</td> </tr> <tr> <td><a href="../service_ls/">docker service ls</a></td> <td>List services</td> </tr> <tr> <td><a href="../service_ps/">docker service ps</a></td> <td>List the tasks of one or more services</td> </tr> <tr> <td><a href="../service_rm/">docker service rm</a></td> <td>Remove one or more services</td> </tr> <tr> <td><a href="../service_scale/">docker service scale</a></td> <td>Scale one or multiple replicated services</td> </tr> <tr> <td><a href="/">docker service update</a></td> <td>Update a service</td> </tr> </tbody> </table> <h2 id="extended-description">Extended description</h2> <p>Updates a service as described by the specified parameters. This command has to be run targeting a manager node. The parameters are the same as <a href="../service_create/"><code class="highlighter-rouge">docker service create</code></a>. Please look at the description there for further information.</p> <p>Normally, updating a service will only cause the service’s tasks to be replaced with new ones if a change to the service requires recreating the tasks for it to take effect. For example, only changing the <code class="highlighter-rouge">--update-parallelism</code> setting will not recreate the tasks, because the individual tasks are not affected by this setting. However, the <code class="highlighter-rouge">--force</code> flag will cause the tasks to be recreated anyway. This can be used to perform a rolling restart without any changes to the service parameters.</p> <h2 id="examples">Examples</h2> <h3 id="update-a-service">Update a service</h3> <pre class="highlight" data-language="bash">$ docker service update --limit-cpu 2 redis
</pre>  <h3 id="perform-a-rolling-restart-with-no-parameter-changes">Perform a rolling restart with no parameter changes</h3> <pre class="highlight" data-language="bash">$ docker service update --force --update-parallelism 1 --update-delay 30s redis
</pre>  <p>In this example, the <code class="highlighter-rouge">--force</code> flag causes the service’s tasks to be shut down and replaced with new ones even though none of the other parameters would normally cause that to happen. The <code class="highlighter-rouge">--update-parallelism 1</code> setting ensures that only one task is replaced at a time (this is the default behavior). The <code class="highlighter-rouge">--update-delay 30s</code> setting introduces a 30 second delay between tasks, so that the rolling restart happens gradually.</p> <h3 id="add-or-remove-mounts">Add or remove mounts</h3> <p>Use the <code class="highlighter-rouge">--mount-add</code> or <code class="highlighter-rouge">--mount-rm</code> options add or remove a service’s bind-mounts or volumes.</p> <p>The following example creates a service which mounts the <code class="highlighter-rouge">test-data</code> volume to <code class="highlighter-rouge">/somewhere</code>. The next step updates the service to also mount the <code class="highlighter-rouge">other-volume</code> volume to <code class="highlighter-rouge">/somewhere-else</code>volume, The last step unmounts the <code class="highlighter-rouge">/somewhere</code> mount point, effectively removing the <code class="highlighter-rouge">test-data</code> volume. Each command returns the service name.</p> <ul> <li> <p>The <code class="highlighter-rouge">--mount-add</code> flag takes the same parameters as the <code class="highlighter-rouge">--mount</code> flag on <code class="highlighter-rouge">service create</code>. Refer to the <a href="../service_create/#volumes-and-bind-mounts-mount">volumes and bind-mounts</a> section in the <code class="highlighter-rouge">service create</code> reference for details.</p> </li> <li> <p>The <code class="highlighter-rouge">--mount-rm</code> flag takes the <code class="highlighter-rouge">target</code> path of the mount.</p> </li> </ul> <pre class="highlight" data-language="bash">$ docker service create \
    --name=myservice \
    --mount \
      type=volume,source=test-data,target=/somewhere \
    nginx:alpine \
    myservice

myservice

$ docker service update \
    --mount-add \
      type=volume,source=other-volume,target=/somewhere-else \
    myservice

myservice

$ docker service update --mount-rm /somewhere myservice

myservice
</pre>  <h3 id="rolling-back-to-the-previous-version-of-a-service">Rolling back to the previous version of a service</h3> <p>Use the <code class="highlighter-rouge">--rollback</code> option to roll back to the previous version of the service.</p> <p>This will revert the service to the configuration that was in place before the most recent <code class="highlighter-rouge">docker service update</code> command.</p> <p>The following example updates the number of replicas for the service from 4 to 5, and then rolls back to the previous configuration.</p> <pre class="highlight" data-language="bash">$ docker service update --replicas=5 web

web

$ docker service ls

ID            NAME  MODE        REPLICAS  IMAGE
80bvrzp6vxf3  web   replicated  0/5       nginx:alpine

</pre>  <p>Roll back the <code class="highlighter-rouge">web</code> service…</p> <pre class="highlight" data-language="bash">$ docker service update --rollback web

web

$ docker service ls

ID            NAME  MODE        REPLICAS  IMAGE
80bvrzp6vxf3  web   replicated  0/4       nginx:alpine

</pre>  <p>Other options can be combined with <code class="highlighter-rouge">--rollback</code> as well, for example, <code class="highlighter-rouge">--update-delay 0s</code> to execute the rollback without a delay between tasks:</p> <pre class="highlight" data-language="bash">$ docker service update \
  --rollback \
  --update-delay 0s
  web

web

</pre>  <p>Services can also be set up to roll back to the previous version automatically when an update fails. To set up a service for automatic rollback, use <code class="highlighter-rouge">--update-failure-action=rollback</code>. A rollback will be triggered if the fraction of the tasks which failed to update successfully exceeds the value given with <code class="highlighter-rouge">--update-max-failure-ratio</code>.</p> <p>The rate, parallelism, and other parameters of a rollback operation are determined by the values passed with the following flags:</p> <ul> <li><code class="highlighter-rouge">--rollback-delay</code></li> <li><code class="highlighter-rouge">--rollback-failure-action</code></li> <li><code class="highlighter-rouge">--rollback-max-failure-ratio</code></li> <li><code class="highlighter-rouge">--rollback-monitor</code></li> <li><code class="highlighter-rouge">--rollback-parallelism</code></li> </ul> <p>For example, a service set up with <code class="highlighter-rouge">--update-parallelism 1 --rollback-parallelism 3</code> will update one task at a time during a normal update, but during a rollback, 3 tasks at a time will get rolled back. These rollback parameters are respected both during automatic rollbacks and for rollbacks initiated manually using <code class="highlighter-rouge">--rollback</code>.</p> <h3 id="add-or-remove-secrets">Add or remove secrets</h3> <p>Use the <code class="highlighter-rouge">--secret-add</code> or <code class="highlighter-rouge">--secret-rm</code> options add or remove a service’s secrets.</p> <p>The following example adds a secret named <code class="highlighter-rouge">ssh-2</code> and removes <code class="highlighter-rouge">ssh-1</code>:</p> <pre class="highlight" data-language="bash">$ docker service update \
    --secret-add source=ssh-2,target=ssh-2 \
    --secret-rm ssh-1 \
    myservice
</pre>  <h3 id="update-services-using-templates">Update services using templates</h3> <p>Some flags of <code class="highlighter-rouge">service update</code> support the use of templating. See <a href="../service_create/#templating"><code class="highlighter-rouge">service create</code></a> for the reference.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © 2017 Docker, Inc.<br>Licensed under the Apache License, Version 2.0.<br>Docker and the Docker logo are trademarks or registered trademarks of Docker, Inc. in the United States and/or other countries.<br>Docker, Inc. and other parties may also have trademark rights in other terms used herein.<br>
    <a href="https://docs.docker.com/engine/reference/commandline/service_update/" class="_attribution-link" target="_blank">https://docs.docker.com/engine/reference/commandline/service_update/</a>
  </p>
</div>

				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 文档结尾内嵌 -->
<ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-2572770204602497"
    data-ad-slot="5446239318"
    data-ad-format="auto"
    data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
