
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Docker Build - Docker 17 - W3cubDocs</title>
  
  <meta name="description" content=" Build an image from a Dockerfile ">
  <meta name="keywords" content="docker, build, -, docker~17">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/docker~17/engine/reference/commandline/build/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-6cc8ff3c95d062e2cd87636799240e79e4553263ad7de9cda9464063203db436.css" integrity="sha256-bMj/PJXQYuLNh2NnmSQOeeRVMmOtfenNqUZAYyA9tDY=" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha256-JOOcjTvTbt5QE9AmOH1rrXz8aKKfHMsOthbsjt9CNfk=" crossorigin="anonymous" src="/assets/application-24e39c8d3bd36ede5013d026387d6bad7cfc68a29f1ccb0eb616ec8edf4235f9.js"></script>
  <script src="/json/docker~17.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-2572770204602497",
            enable_page_level_ads: true
        });
  </script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/docker~17/" class="_nav-link" title="" style="margin-left:0;">Docker 17</a></span>
  
  <nav class="_nav">
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _simple">
				
				
<h1>docker build</h1>    <h2 id="description">Description</h2> <p>Build an image from a Dockerfile</p> <h2 id="usage">Usage</h2> <pre data-language="">docker build [OPTIONS] PATH | URL | -
</pre> <h2 id="options">Options</h2> <table> <thead> <tr> <th>Name, shorthand</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="highlighter-rouge">--add-host</code></td> <td> </td> <td>Add a custom host-to-IP mapping (host:ip)</td> </tr> <tr> <td><code class="highlighter-rouge">--build-arg</code></td> <td> </td> <td>Set build-time variables</td> </tr> <tr> <td><code class="highlighter-rouge">--cache-from</code></td> <td> </td> <td>Images to consider as cache sources</td> </tr> <tr> <td><code class="highlighter-rouge">--cgroup-parent</code></td> <td> </td> <td>Optional parent cgroup for the container</td> </tr> <tr> <td><code class="highlighter-rouge">--compress</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Compress the build context using gzip</td> </tr> <tr> <td><code class="highlighter-rouge">--cpu-period</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Limit the CPU CFS (Completely Fair Scheduler) period</td> </tr> <tr> <td><code class="highlighter-rouge">--cpu-quota</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Limit the CPU CFS (Completely Fair Scheduler) quota</td> </tr> <tr> <td><code class="highlighter-rouge">--cpu-shares, -c</code></td> <td><code class="highlighter-rouge">0</code></td> <td>CPU shares (relative weight)</td> </tr> <tr> <td><code class="highlighter-rouge">--cpuset-cpus</code></td> <td> </td> <td>CPUs in which to allow execution (0-3, 0,1)</td> </tr> <tr> <td><code class="highlighter-rouge">--cpuset-mems</code></td> <td> </td> <td>MEMs in which to allow execution (0-3, 0,1)</td> </tr> <tr> <td><code class="highlighter-rouge">--disable-content-trust</code></td> <td><code class="highlighter-rouge">true</code></td> <td>Skip image verification</td> </tr> <tr> <td><code class="highlighter-rouge">--file, -f</code></td> <td> </td> <td>Name of the Dockerfile (Default is ‘PATH/Dockerfile’)</td> </tr> <tr> <td><code class="highlighter-rouge">--force-rm</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Always remove intermediate containers</td> </tr> <tr> <td><code class="highlighter-rouge">--iidfile</code></td> <td> </td> <td>Write the image ID to the file</td> </tr> <tr> <td><code class="highlighter-rouge">--isolation</code></td> <td> </td> <td>Container isolation technology</td> </tr> <tr> <td><code class="highlighter-rouge">--label</code></td> <td> </td> <td>Set metadata for an image</td> </tr> <tr> <td><code class="highlighter-rouge">--memory, -m</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Memory limit</td> </tr> <tr> <td><code class="highlighter-rouge">--memory-swap</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Swap limit equal to memory plus swap: ‘-1’ to enable unlimited swap</td> </tr> <tr> <td><code class="highlighter-rouge">--network</code></td> <td><code class="highlighter-rouge">default</code></td> <td>Set the networking mode for the RUN instructions during build</td> </tr> <tr> <td><code class="highlighter-rouge">--no-cache</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Do not use cache when building the image</td> </tr> <tr> <td><code class="highlighter-rouge">--pull</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Always attempt to pull a newer version of the image</td> </tr> <tr> <td><code class="highlighter-rouge">--quiet, -q</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Suppress the build output and print image ID on success</td> </tr> <tr> <td><code class="highlighter-rouge">--rm</code></td> <td><code class="highlighter-rouge">true</code></td> <td>Remove intermediate containers after a successful build</td> </tr> <tr> <td><code class="highlighter-rouge">--security-opt</code></td> <td> </td> <td>Security options</td> </tr> <tr> <td><code class="highlighter-rouge">--shm-size</code></td> <td><code class="highlighter-rouge">0</code></td> <td>Size of /dev/shm</td> </tr> <tr> <td><code class="highlighter-rouge">--squash</code></td> <td><code class="highlighter-rouge">false</code></td> <td>Squash newly built layers into a single new layer</td> </tr> <tr> <td><code class="highlighter-rouge">--tag, -t</code></td> <td> </td> <td>Name and optionally a tag in the ‘name:tag’ format</td> </tr> <tr> <td><code class="highlighter-rouge">--target</code></td> <td> </td> <td>Set the target build stage to build.</td> </tr> <tr> <td><code class="highlighter-rouge">--ulimit</code></td> <td> </td> <td>Ulimit options</td> </tr> </tbody> </table> <h2 id="parent-command">Parent command</h2> <table> <thead> <tr> <th>Command</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><a href="../docker/">docker</a></td> <td>The base command for the Docker CLI.</td> </tr> </tbody> </table> <h2 id="extended-description">Extended description</h2> <p>The <code class="highlighter-rouge">docker build</code> command builds Docker images from a Dockerfile and a “context”. A build’s context is the set of files located in the specified <code class="highlighter-rouge">PATH</code> or <code class="highlighter-rouge">URL</code>. The build process can refer to any of the files in the context. For example, your build can use a <a href="../../builder/#copy"><em>COPY</em></a> instruction to reference a file in the context.</p> <p>The <code class="highlighter-rouge">URL</code> parameter can refer to three kinds of resources: Git repositories, pre-packaged tarball contexts and plain text files.</p> <h3 id="git-repositories">Git repositories</h3> <p>When the <code class="highlighter-rouge">URL</code> parameter points to the location of a Git repository, the repository acts as the build context. The system recursively fetches the repository and its submodules. The commit history is not preserved. A repository is first pulled into a temporary directory on your local host. After the that succeeds, the directory is sent to the Docker daemon as the context. Local copy gives you the ability to access private repositories using local user credentials, VPN’s, and so forth.</p> <blockquote> <p><strong>Note:</strong> If the <code class="highlighter-rouge">URL</code> parameter contains a fragment the system will recursively clone the repository and its submodules using a <code class="highlighter-rouge">git clone --recursive</code> command.</p> </blockquote> <p>Git URLs accept context configuration in their fragment section, separated by a colon <code class="highlighter-rouge">:</code>. The first part represents the reference that Git will check out, and can be either a branch, a tag, or a remote reference. The second part represents a subdirectory inside the repository that will be used as a build context.</p> <p>For example, run this command to use a directory called <code class="highlighter-rouge">docker</code> in the branch <code class="highlighter-rouge">container</code>:</p> <pre class="highlight" data-language="bash">$ docker build https://github.com/docker/rootfs.git#container:docker
</pre>  <p>The following table represents all the valid suffixes with their build contexts:</p> <table> <thead> <tr> <th>Build Syntax Suffix</th> <th>Commit Used</th> <th>Build Context Used</th> </tr> </thead> <tbody> <tr> <td><code class="highlighter-rouge">myrepo.git</code></td> <td><code class="highlighter-rouge">refs/heads/master</code></td> <td><code class="highlighter-rouge">/</code></td> </tr> <tr> <td><code class="highlighter-rouge">myrepo.git#mytag</code></td> <td><code class="highlighter-rouge">refs/tags/mytag</code></td> <td><code class="highlighter-rouge">/</code></td> </tr> <tr> <td><code class="highlighter-rouge">myrepo.git#mybranch</code></td> <td><code class="highlighter-rouge">refs/heads/mybranch</code></td> <td><code class="highlighter-rouge">/</code></td> </tr> <tr> <td><code class="highlighter-rouge">myrepo.git#pull/42/head</code></td> <td><code class="highlighter-rouge">refs/pull/42/head</code></td> <td><code class="highlighter-rouge">/</code></td> </tr> <tr> <td><code class="highlighter-rouge">myrepo.git#:myfolder</code></td> <td><code class="highlighter-rouge">refs/heads/master</code></td> <td><code class="highlighter-rouge">/myfolder</code></td> </tr> <tr> <td><code class="highlighter-rouge">myrepo.git#master:myfolder</code></td> <td><code class="highlighter-rouge">refs/heads/master</code></td> <td><code class="highlighter-rouge">/myfolder</code></td> </tr> <tr> <td><code class="highlighter-rouge">myrepo.git#mytag:myfolder</code></td> <td><code class="highlighter-rouge">refs/tags/mytag</code></td> <td><code class="highlighter-rouge">/myfolder</code></td> </tr> <tr> <td><code class="highlighter-rouge">myrepo.git#mybranch:myfolder</code></td> <td><code class="highlighter-rouge">refs/heads/mybranch</code></td> <td><code class="highlighter-rouge">/myfolder</code></td> </tr> </tbody> </table> <h3 id="tarball-contexts">Tarball contexts</h3> <p>If you pass an URL to a remote tarball, the URL itself is sent to the daemon:</p> <pre class="highlight" data-language="bash">$ docker build http://server/context.tar.gz
</pre>  <p>The download operation will be performed on the host the Docker daemon is running on, which is not necessarily the same host from which the build command is being issued. The Docker daemon will fetch <code class="highlighter-rouge">context.tar.gz</code> and use it as the build context. Tarball contexts must be tar archives conforming to the standard <code class="highlighter-rouge">tar</code> UNIX format and can be compressed with any one of the ‘xz’, ‘bzip2’, ‘gzip’ or ‘identity’ (no compression) formats.</p> <h3 id="text-files">Text files</h3> <p>Instead of specifying a context, you can pass a single <code class="highlighter-rouge">Dockerfile</code> in the <code class="highlighter-rouge">URL</code> or pipe the file in via <code class="highlighter-rouge">STDIN</code>. To pipe a <code class="highlighter-rouge">Dockerfile</code> from <code class="highlighter-rouge">STDIN</code>:</p> <pre class="highlight" data-language="bash">$ docker build - &lt; Dockerfile
</pre>  <p>With Powershell on Windows, you can run:</p> <pre class="highlight" data-language="powershell">Get-Content Dockerfile | docker build -
</pre>  <p>If you use <code class="highlighter-rouge">STDIN</code> or specify a <code class="highlighter-rouge">URL</code> pointing to a plain text file, the system places the contents into a file called <code class="highlighter-rouge">Dockerfile</code>, and any <code class="highlighter-rouge">-f</code>, <code class="highlighter-rouge">--file</code> option is ignored. In this scenario, there is no context.</p> <p>By default the <code class="highlighter-rouge">docker build</code> command will look for a <code class="highlighter-rouge">Dockerfile</code> at the root of the build context. The <code class="highlighter-rouge">-f</code>, <code class="highlighter-rouge">--file</code>, option lets you specify the path to an alternative file to use instead. This is useful in cases where the same set of files are used for multiple builds. The path must be to a file within the build context. If a relative path is specified then it is interpreted as relative to the root of the context.</p> <p>In most cases, it’s best to put each Dockerfile in an empty directory. Then, add to that directory only the files needed for building the Dockerfile. To increase the build’s performance, you can exclude files and directories by adding a <code class="highlighter-rouge">.dockerignore</code> file to that directory as well. For information on creating one, see the <a href="../../builder/#dockerignore-file">.dockerignore file</a>.</p> <p>If the Docker client loses connection to the daemon, the build is canceled. This happens if you interrupt the Docker client with <code class="highlighter-rouge">CTRL-c</code> or if the Docker client is killed for any reason. If the build initiated a pull which is still running at the time the build is cancelled, the pull is cancelled as well.</p> <h2 id="examples">Examples</h2> <h3 id="build-with-path">Build with PATH</h3> <pre class="highlight" data-language="bash">$ docker build .

Uploading context 10240 bytes
Step 1/3 : FROM busybox
Pulling repository busybox
 ---&gt; e9aa60c60128MB/2.284 MB (100%) endpoint: https://cdn-registry-1.docker.io/v1/
Step 2/3 : RUN ls -lh /
 ---&gt; Running in 9c9e81692ae9
total 24
drwxr-xr-x    2 root     root        4.0K Mar 12  2013 bin
drwxr-xr-x    5 root     root        4.0K Oct 19 00:19 dev
drwxr-xr-x    2 root     root        4.0K Oct 19 00:19 etc
drwxr-xr-x    2 root     root        4.0K Nov 15 23:34 lib
lrwxrwxrwx    1 root     root           3 Mar 12  2013 lib64 -&gt; lib
dr-xr-xr-x  116 root     root           0 Nov 15 23:34 proc
lrwxrwxrwx    1 root     root           3 Mar 12  2013 sbin -&gt; bin
dr-xr-xr-x   13 root     root           0 Nov 15 23:34 sys
drwxr-xr-x    2 root     root        4.0K Mar 12  2013 tmp
drwxr-xr-x    2 root     root        4.0K Nov 15 23:34 usr
 ---&gt; b35f4035db3f
Step 3/3 : CMD echo Hello world
 ---&gt; Running in 02071fceb21b
 ---&gt; f52f38b7823e
Successfully built f52f38b7823e
Removing intermediate container 9c9e81692ae9
Removing intermediate container 02071fceb21b
</pre>  <p>This example specifies that the <code class="highlighter-rouge">PATH</code> is <code class="highlighter-rouge">.</code>, and so all the files in the local directory get <code class="highlighter-rouge">tar</code>d and sent to the Docker daemon. The <code class="highlighter-rouge">PATH</code> specifies where to find the files for the “context” of the build on the Docker daemon. Remember that the daemon could be running on a remote machine and that no parsing of the Dockerfile happens at the client side (where you’re running <code class="highlighter-rouge">docker build</code>). That means that <em>all</em> the files at <code class="highlighter-rouge">PATH</code> get sent, not just the ones listed to <a href="../../builder/#add"><em>ADD</em></a> in the Dockerfile.</p> <p>The transfer of context from the local machine to the Docker daemon is what the <code class="highlighter-rouge">docker</code> client means when you see the “Sending build context” message.</p> <p>If you wish to keep the intermediate containers after the build is complete, you must use <code class="highlighter-rouge">--rm=false</code>. This does not affect the build cache.</p> <h3 id="build-with-url">Build with URL</h3> <pre class="highlight" data-language="bash">$ docker build github.com/creack/docker-firefox
</pre>  <p>This will clone the GitHub repository and use the cloned repository as context. The Dockerfile at the root of the repository is used as Dockerfile. You can specify an arbitrary Git repository by using the <code class="highlighter-rouge">git://</code> or <code class="highlighter-rouge">git@</code> scheme.</p> <pre class="highlight" data-language="bash">$ docker build -f ctx/Dockerfile http://server/ctx.tar.gz

Downloading context: http://server/ctx.tar.gz [===================&gt;]    240 B/240 B
Step 1/3 : FROM busybox
 ---&gt; 8c2e06607696
Step 2/3 : ADD ctx/container.cfg /
 ---&gt; e7829950cee3
Removing intermediate container b35224abf821
Step 3/3 : CMD /bin/ls
 ---&gt; Running in fbc63d321d73
 ---&gt; 3286931702ad
Removing intermediate container fbc63d321d73
Successfully built 377c409b35e4
</pre>  <p>This sends the URL <code class="highlighter-rouge">http://server/ctx.tar.gz</code> to the Docker daemon, which downloads and extracts the referenced tarball. The <code class="highlighter-rouge">-f ctx/Dockerfile</code> parameter specifies a path inside <code class="highlighter-rouge">ctx.tar.gz</code> to the <code class="highlighter-rouge">Dockerfile</code> that is used to build the image. Any <code class="highlighter-rouge">ADD</code> commands in that <code class="highlighter-rouge">Dockerfile</code> that refers to local paths must be relative to the root of the contents inside <code class="highlighter-rouge">ctx.tar.gz</code>. In the example above, the tarball contains a directory <code class="highlighter-rouge">ctx/</code>, so the <code class="highlighter-rouge">ADD ctx/container.cfg /</code> operation works as expected.</p> <h3 id="build-with--">Build with -</h3> <pre class="highlight" data-language="bash">$ docker build - &lt; Dockerfile
</pre>  <p>This will read a Dockerfile from <code class="highlighter-rouge">STDIN</code> without context. Due to the lack of a context, no contents of any local directory will be sent to the Docker daemon. Since there is no context, a Dockerfile <code class="highlighter-rouge">ADD</code> only works if it refers to a remote URL.</p> <pre class="highlight" data-language="bash">$ docker build - &lt; context.tar.gz
</pre>  <p>This will build an image for a compressed context read from <code class="highlighter-rouge">STDIN</code>. Supported formats are: bzip2, gzip and xz.</p> <h3 id="use-a-dockerignore-file">Use a .dockerignore file</h3> <pre class="highlight" data-language="bash">$ docker build .

Uploading context 18.829 MB
Uploading context
Step 1/2 : FROM busybox
 ---&gt; 769b9341d937
Step 2/2 : CMD echo Hello world
 ---&gt; Using cache
 ---&gt; 99cc1ad10469
Successfully built 99cc1ad10469
$ echo ".git" &gt; .dockerignore
$ docker build .
Uploading context  6.76 MB
Uploading context
Step 1/2 : FROM busybox
 ---&gt; 769b9341d937
Step 2/2 : CMD echo Hello world
 ---&gt; Using cache
 ---&gt; 99cc1ad10469
Successfully built 99cc1ad10469
</pre>  <p>This example shows the use of the <code class="highlighter-rouge">.dockerignore</code> file to exclude the <code class="highlighter-rouge">.git</code> directory from the context. Its effect can be seen in the changed size of the uploaded context. The builder reference contains detailed information on <a href="../../builder/#dockerignore-file">creating a .dockerignore file</a></p> <h3 id="tag-an-image--t">Tag an image (-t)</h3> <pre class="highlight" data-language="bash">$ docker build -t vieux/apache:2.0 .
</pre>  <p>This will build like the previous example, but it will then tag the resulting image. The repository name will be <code class="highlighter-rouge">vieux/apache</code> and the tag will be <code class="highlighter-rouge">2.0</code>. <a href="../tag/">Read more about valid tags</a>.</p> <p>You can apply multiple tags to an image. For example, you can apply the <code class="highlighter-rouge">latest</code> tag to a newly built image and add another tag that references a specific version. For example, to tag an image both as <code class="highlighter-rouge">whenry/fedora-jboss:latest</code> and <code class="highlighter-rouge">whenry/fedora-jboss:v2.1</code>, use the following:</p> <pre class="highlight" data-language="bash">$ docker build -t whenry/fedora-jboss:latest -t whenry/fedora-jboss:v2.1 .
</pre>  <h3 id="specify-a-dockerfile--f">Specify a Dockerfile (-f)</h3> <pre class="highlight" data-language="bash">$ docker build -f Dockerfile.debug .
</pre>  <p>This will use a file called <code class="highlighter-rouge">Dockerfile.debug</code> for the build instructions instead of <code class="highlighter-rouge">Dockerfile</code>.</p> <pre class="highlight" data-language="bash">$ curl example.com/remote/Dockerfile | docker build -f - .
</pre>  <p>The above command will use the current directory as the build context and read a Dockerfile from stdin.</p> <pre class="highlight" data-language="bash">$ docker build -f dockerfiles/Dockerfile.debug -t myapp_debug .
$ docker build -f dockerfiles/Dockerfile.prod  -t myapp_prod .
</pre>  <p>The above commands will build the current build context (as specified by the <code class="highlighter-rouge">.</code>) twice, once using a debug version of a <code class="highlighter-rouge">Dockerfile</code> and once using a production version.</p> <pre class="highlight" data-language="bash">$ cd /home/me/myapp/some/dir/really/deep
$ docker build -f /home/me/myapp/dockerfiles/debug /home/me/myapp
$ docker build -f ../../../../dockerfiles/debug /home/me/myapp
</pre>  <p>These two <code class="highlighter-rouge">docker build</code> commands do the exact same thing. They both use the contents of the <code class="highlighter-rouge">debug</code> file instead of looking for a <code class="highlighter-rouge">Dockerfile</code> and will use <code class="highlighter-rouge">/home/me/myapp</code> as the root of the build context. Note that <code class="highlighter-rouge">debug</code> is in the directory structure of the build context, regardless of how you refer to it on the command line.</p> <blockquote> <p><strong>Note:</strong> <code class="highlighter-rouge">docker build</code> will return a <code class="highlighter-rouge">no such file or directory</code> error if the file or directory does not exist in the uploaded context. This may happen if there is no context, or if you specify a file that is elsewhere on the Host system. The context is limited to the current directory (and its children) for security reasons, and to ensure repeatable builds on remote Docker hosts. This is also the reason why <code class="highlighter-rouge">ADD ../file</code> will not work.</p> </blockquote> <h3 id="use-a-custom-parent-cgroup-cgroup-parent">Use a custom parent cgroup (–cgroup-parent)</h3> <p>When <code class="highlighter-rouge">docker build</code> is run with the <code class="highlighter-rouge">--cgroup-parent</code> option the containers used in the build will be run with the <a href="../../run/#specifying-custom-cgroups">corresponding <code class="highlighter-rouge">docker run</code> flag</a>.</p> <h3 id="set-ulimits-in-container-ulimit">Set ulimits in container (–ulimit)</h3> <p>Using the <code class="highlighter-rouge">--ulimit</code> option with <code class="highlighter-rouge">docker build</code> will cause each build step’s container to be started using those <a href="../run/#set-ulimits-in-container-ulimit"><code class="highlighter-rouge">--ulimit</code> flag values</a>.</p> <h3 id="set-build-time-variables-build-arg">Set build-time variables (–build-arg)</h3> <p>You can use <code class="highlighter-rouge">ENV</code> instructions in a Dockerfile to define variable values. These values persist in the built image. However, often persistence is not what you want. Users want to specify variables differently depending on which host they build an image on.</p> <p>A good example is <code class="highlighter-rouge">http_proxy</code> or source versions for pulling intermediate files. The <code class="highlighter-rouge">ARG</code> instruction lets Dockerfile authors define values that users can set at build-time using the <code class="highlighter-rouge">--build-arg</code> flag:</p> <pre class="highlight" data-language="bash">$ docker build --build-arg HTTP_PROXY=http://10.20.30.2:1234 .
</pre>  <p>This flag allows you to pass the build-time variables that are accessed like regular environment variables in the <code class="highlighter-rouge">RUN</code> instruction of the Dockerfile. Also, these values don’t persist in the intermediate or final images like <code class="highlighter-rouge">ENV</code> values do.</p> <p>Using this flag will not alter the output you see when the <code class="highlighter-rouge">ARG</code> lines from the Dockerfile are echoed during the build process.</p> <p>For detailed information on using <code class="highlighter-rouge">ARG</code> and <code class="highlighter-rouge">ENV</code> instructions, see the <a href="../../builder/">Dockerfile reference</a>.</p> <h3 id="optional-security-options-security-opt">Optional security options (–security-opt)</h3> <p>This flag is only supported on a daemon running on Windows, and only supports the <code class="highlighter-rouge">credentialspec</code> option. The <code class="highlighter-rouge">credentialspec</code> must be in the format <code class="highlighter-rouge">file://spec.txt</code> or <code class="highlighter-rouge">registry://keyname</code>.</p> <h3 id="specify-isolation-technology-for-container-isolation">Specify isolation technology for container (–isolation)</h3> <p>This option is useful in situations where you are running Docker containers on Windows. The <code class="highlighter-rouge">--isolation=&lt;value&gt;</code> option sets a container’s isolation technology. On Linux, the only supported is the <code class="highlighter-rouge">default</code> option which uses Linux namespaces. On Microsoft Windows, you can specify these values:</p> <table> <thead> <tr> <th>Value</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="highlighter-rouge">default</code></td> <td>Use the value specified by the Docker daemon’s <code class="highlighter-rouge">--exec-opt</code> . If the <code class="highlighter-rouge">daemon</code> does not specify an isolation technology, Microsoft Windows uses <code class="highlighter-rouge">process</code> as its default value.</td> </tr> <tr> <td><code class="highlighter-rouge">process</code></td> <td>Namespace isolation only.</td> </tr> <tr> <td><code class="highlighter-rouge">hyperv</code></td> <td>Hyper-V hypervisor partition-based isolation.</td> </tr> </tbody> </table> <p>Specifying the <code class="highlighter-rouge">--isolation</code> flag without a value is the same as setting <code class="highlighter-rouge">--isolation="default"</code>.</p> <h3 id="add-entries-to-container-hosts-file-add-host">Add entries to container hosts file (–add-host)</h3> <p>You can add other hosts into a container’s <code class="highlighter-rouge">/etc/hosts</code> file by using one or more <code class="highlighter-rouge">--add-host</code> flags. This example adds a static address for a host named <code class="highlighter-rouge">docker</code>:</p> <pre class="highlight" data-language="">$ docker build --add-host=docker:10.180.0.1 .
</pre>  <h3 id="specifying-target-build-stage-target">Specifying target build stage (–target)</h3> <p>When building a Dockerfile with multiple build stages, <code class="highlighter-rouge">--target</code> can be used to specify an intermediate build stage by name as a final stage for the resulting image. Commands after the target stage will be skipped.</p> <pre data-language="">FROM debian AS build-env
...

FROM alpine AS production-env
...
</pre> <pre class="highlight" data-language="bash">$ docker build -t mybuildimage --target build-env .
</pre>  <h3 id="squash-an-images-layers-squash-experimental-only">Squash an image’s layers (–squash) <strong>Experimental Only</strong>
</h3> <h4 id="overview">Overview</h4> <p>Once the image is built, squash the new layers into a new image with a single new layer. Squashing does not destroy any existing image, rather it creates a new image with the content of the squashed layers. This effectively makes it look like all <code class="highlighter-rouge">Dockerfile</code> commands were created with a single layer. The build cache is preserved with this method.</p> <p><strong>Note</strong>: using this option means the new image will not be able to take advantage of layer sharing with other images and may use significantly more space.</p> <p><strong>Note</strong>: using this option you may see significantly more space used due to storing two copies of the image, one for the build cache with all the cache layers in tact, and one for the squashed version.</p> <h4 id="prerequisites">Prerequisites</h4> <p>The example on this page is using experimental mode in Docker 1.13.</p> <p>Experimental mode can be enabled by using the <code class="highlighter-rouge">--experimental</code> flag when starting the Docker daemon or setting <code class="highlighter-rouge">experimental: true</code> in the <code class="highlighter-rouge">daemon.json</code> configuration file.</p> <p>By default, experimental mode is disabled. To see the current configuration, use the <code class="highlighter-rouge">docker version</code> command.</p> <pre data-language="">
Server:
 Version:      1.13.1
 API version:  1.26 (minimum version 1.12)
 Go version:   go1.7.5
 Git commit:   092cba3
 Built:        Wed Feb  8 06:35:24 2017
 OS/Arch:      linux/amd64
 Experimental: false

 [...]

</pre> <p>To enable experimental mode, users need to restart the docker daemon with the experimental flag enabled.</p> <h4 id="enable-docker-experimental">Enable Docker experimental</h4> <p>Experimental features are now included in the standard Docker binaries as of version 1.13.0. For enabling experimental features, you need to start the Docker daemon with <code class="highlighter-rouge">--experimental</code> flag. You can also enable the daemon flag via /etc/docker/daemon.json. e.g.</p> <pre class="highlight" data-language="">
{
    "experimental": true
}

</pre>  <p>Then make sure the experimental flag is enabled:</p> <pre class="highlight" data-language="bash">
$ docker version -f '{{.Server.Experimental}}'
true

</pre>  <h4 id="build-an-image-with---squash-argument">Build an image with <code class="highlighter-rouge">--squash</code> argument</h4> <p>The following is an example of docker build with <code class="highlighter-rouge">--squash</code> argument</p> <pre data-language="">
FROM busybox
RUN echo hello &gt; /hello
RUN echo world &gt;&gt; /hello
RUN touch remove_me /remove_me
ENV HELLO world
RUN rm /remove_me

</pre> <p>An image named <code class="highlighter-rouge">test</code> is built with <code class="highlighter-rouge">--squash</code> argument.</p> <pre class="highlight" data-language="bash">
$ docker build --squash -t test .

[...]

</pre>  <p>If everything is right, the history will look like this:</p> <pre class="highlight" data-language="bash">$ docker history test 

IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
4e10cb5b4cac        3 seconds ago                                                       12 B                merge sha256:88a7b0112a41826885df0e7072698006ee8f621c6ab99fca7fe9151d7b599702 to sha256:47bcc53f74dc94b1920f0b34f6036096526296767650f223433fe65c35f149eb
&lt;missing&gt;           5 minutes ago       /bin/sh -c rm /remove_me                        0 B
&lt;missing&gt;           5 minutes ago       /bin/sh -c #(nop) ENV HELLO=world               0 B
&lt;missing&gt;           5 minutes ago       /bin/sh -c touch remove_me /remove_me           0 B
&lt;missing&gt;           5 minutes ago       /bin/sh -c echo world &gt;&gt; /hello                 0 B
&lt;missing&gt;           6 minutes ago       /bin/sh -c echo hello &gt; /hello                  0 B
&lt;missing&gt;           7 weeks ago         /bin/sh -c #(nop) CMD ["sh"]                    0 B
&lt;missing&gt;           7 weeks ago         /bin/sh -c #(nop) ADD file:47ca6e777c36a4cfff   1.113 MB

</pre>  <p>We could find that all layer’s name is <code class="highlighter-rouge">&lt;missing&gt;</code>, and there is a new layer with COMMENT <code class="highlighter-rouge">merge</code>.</p> <p>Test the image, check for <code class="highlighter-rouge">/remove_me</code> being gone, make sure <code class="highlighter-rouge">hello\nworld</code> is in <code class="highlighter-rouge">/hello</code>, make sure the <code class="highlighter-rouge">HELLO</code> envvar’s value is <code class="highlighter-rouge">world</code>.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © 2017 Docker, Inc.<br>Licensed under the Apache License, Version 2.0.<br>Docker and the Docker logo are trademarks or registered trademarks of Docker, Inc. in the United States and/or other countries.<br>Docker, Inc. and other parties may also have trademark rights in other terms used herein.<br>
    <a href="https://docs.docker.com/engine/reference/commandline/build/" class="_attribution-link" target="_blank">https://docs.docker.com/engine/reference/commandline/build/</a>
  </p>
</div>

				<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
</amp-auto-ads>
			</div>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
